{
  "version": 3,
  "sources": ["../../src/index.js"],
  "sourcesContent": ["/*!\n * DOM Selector - A CSS selector engine.\n * @license MIT\n * @copyright asamuzaK (Kazz)\n * @see {@link https://github.com/asamuzaK/domSelector/blob/main/LICENSE}\n */\n\n/* import */\nimport { Finder } from './js/finder.js';\nimport { filterSelector, getType, initNwsapi } from './js/utility.js';\n\n/* constants */\nimport {\n  DOCUMENT_NODE, ELEMENT_NODE, REG_COMPLEX, TARGET_ALL, TARGET_FIRST,\n  TARGET_LINEAL, TARGET_SELF\n} from './js/constant.js';\n\n/* DOMSelector */\nexport class DOMSelector {\n  /* private fields */\n  #document;\n  #finder;\n  #nwsapi;\n\n  /**\n   * construct\n   * @param {object} window - window\n   * @param {object} document - document\n   */\n  constructor(window, document) {\n    this.#document = document ?? window.document;\n    this.#finder = new Finder(window);\n    this.#nwsapi = initNwsapi(window, document);\n  }\n\n  /**\n   * matches\n   * @param {string} selector - CSS selector\n   * @param {object} node - Element node\n   * @param {object} opt - options\n   * @returns {boolean} - `true` if matched `false` otherwise\n   */\n  matches(selector, node, opt) {\n    if (!node?.nodeType) {\n      const e = new TypeError(`Unexpected type ${getType(node)}`);\n      this.#finder.onError(e, opt);\n    } else if (node.nodeType !== ELEMENT_NODE) {\n      const e = new TypeError(`Unexpected node ${node.nodeName}`);\n      this.#finder.onError(e, opt);\n    }\n    const document = node.ownerDocument;\n    if (document === this.#document && document.contentType === 'text/html') {\n      const filterOpt = {\n        complex: REG_COMPLEX.test(selector),\n        target: TARGET_SELF\n      };\n      if (filterSelector(selector, filterOpt)) {\n        try {\n          const res = this.#nwsapi.match(selector, node);\n          return res;\n        } catch (e) {\n          // fall through\n        }\n      }\n    }\n    let res;\n    try {\n      this.#finder.setup(selector, node, opt);\n      const nodes = this.#finder.find(TARGET_SELF);\n      res = nodes.size;\n    } catch (e) {\n      this.#finder.onError(e, opt);\n    }\n    return !!res;\n  }\n\n  /**\n   * closest\n   * @param {string} selector - CSS selector\n   * @param {object} node - Element node\n   * @param {object} opt - options\n   * @returns {?object} - matched node\n   */\n  closest(selector, node, opt) {\n    if (!node?.nodeType) {\n      const e = new TypeError(`Unexpected type ${getType(node)}`);\n      this.#finder.onError(e, opt);\n    } else if (node.nodeType !== ELEMENT_NODE) {\n      const e = new TypeError(`Unexpected node ${node.nodeName}`);\n      this.#finder.onError(e, opt);\n    }\n    const document = node.ownerDocument;\n    if (document === this.#document && document.contentType === 'text/html') {\n      const filterOpt = {\n        complex: REG_COMPLEX.test(selector),\n        target: TARGET_LINEAL\n      };\n      if (filterSelector(selector, filterOpt)) {\n        try {\n          const res = this.#nwsapi.closest(selector, node);\n          return res;\n        } catch (e) {\n          // fall through\n        }\n      }\n    }\n    let res;\n    try {\n      this.#finder.setup(selector, node, opt);\n      const nodes = this.#finder.find(TARGET_LINEAL);\n      if (nodes.size) {\n        let refNode = node;\n        while (refNode) {\n          if (nodes.has(refNode)) {\n            res = refNode;\n            break;\n          }\n          refNode = refNode.parentNode;\n        }\n      }\n    } catch (e) {\n      this.#finder.onError(e, opt);\n    }\n    return res ?? null;\n  }\n\n  /**\n   * query selector\n   * @param {string} selector - CSS selector\n   * @param {object} node - Document, DocumentFragment, Element node\n   * @param {object} opt - options\n   * @returns {?object} - matched node\n   */\n  querySelector(selector, node, opt) {\n    if (!node?.nodeType) {\n      const e = new TypeError(`Unexpected type ${getType(node)}`);\n      this.#finder.onError(e, opt);\n    }\n    let document;\n    if (node.nodeType === DOCUMENT_NODE) {\n      document = node;\n    } else {\n      document = node.ownerDocument;\n    }\n    if (document === this.#document && document.contentType === 'text/html') {\n      const filterOpt = {\n        complex: false,\n        target: TARGET_FIRST\n      };\n      if (filterSelector(selector, filterOpt)) {\n        try {\n          const res = this.#nwsapi.first(selector, node);\n          return res;\n        } catch (e) {\n          // fall through\n        }\n      }\n    }\n    let res;\n    try {\n      this.#finder.setup(selector, node, opt);\n      const nodes = this.#finder.find(TARGET_FIRST);\n      if (nodes.size) {\n        [res] = nodes;\n      }\n    } catch (e) {\n      this.#finder.onError(e, opt);\n    }\n    return res ?? null;\n  }\n\n  /**\n   * query selector all\n   * NOTE: returns Array, not NodeList\n   * @param {string} selector - CSS selector\n   * @param {object} node - Document, DocumentFragment, Element node\n   * @param {object} opt - options\n   * @returns {Array.<object|undefined>} - collection of matched nodes\n   */\n  querySelectorAll(selector, node, opt) {\n    if (!node?.nodeType) {\n      const e = new TypeError(`Unexpected type ${getType(node)}`);\n      this.#finder.onError(e, opt);\n    }\n    let document;\n    if (node.nodeType === DOCUMENT_NODE) {\n      document = node;\n    } else {\n      document = node.ownerDocument;\n    }\n    if (document === this.#document && document.contentType === 'text/html') {\n      const filterOpt = {\n        complex: false,\n        target: TARGET_ALL\n      };\n      if (filterSelector(selector, filterOpt)) {\n        try {\n          const res = this.#nwsapi.select(selector, node);\n          return res;\n        } catch (e) {\n          // fall through\n        }\n      }\n    }\n    let res;\n    try {\n      this.#finder.setup(selector, node, opt);\n      const nodes = this.#finder.find(TARGET_ALL);\n      if (nodes.size) {\n        res = [...nodes];\n      }\n    } catch (e) {\n      this.#finder.onError(e, opt);\n    }\n    return res ?? [];\n  }\n}\n"],
  "mappings": "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",
  "names": ["src_exports", "__export", "DOMSelector", "__toCommonJS", "import_finder", "import_utility", "import_constant", "#document", "#finder", "#nwsapi", "window", "document", "selector", "node", "opt", "filterOpt", "res", "nodes", "refNode"]
}
