{
  "version": 3,
  "sources": ["../../src/index.js"],
  "sourcesContent": ["/*!\n * DOM Selector - A CSS selector engine.\n * @license MIT\n * @copyright asamuzaK (Kazz)\n * @see {@link https://github.com/asamuzaK/domSelector/blob/main/LICENSE}\n */\n\n/* import */\nimport { Finder } from './js/finder.js';\nimport { filterSelector, getType, initNwsapi } from './js/utility.js';\n\n/* constants */\nimport {\n  COMBO, COMPOUND_I, DESCEND, DOCUMENT_NODE, ELEMENT_NODE, TAG_ID_CLASS,\n  TARGET_ALL, TARGET_FIRST, TARGET_LINEAL, TARGET_SELF\n} from './js/constant.js';\nconst REG_COMPLEX = new RegExp(`${COMPOUND_I}${COMBO}${COMPOUND_I}`, 'i');\nconst REG_DESCEND = new RegExp(`${COMPOUND_I}${DESCEND}${COMPOUND_I}`, 'i');\nconst REG_SIMPLE = new RegExp(`^${TAG_ID_CLASS}$`);\n\n/* DOMSelector */\nexport class DOMSelector {\n  /* private fields */\n  #window;\n  #document;\n  #finder;\n  #nwsapi;\n\n  /**\n   * construct\n   * @param {object} window - window\n   * @param {object} document - document\n   */\n  constructor(window, document) {\n    this.#window = window;\n    this.#document = document ?? window.document;\n    this.#finder = new Finder(window);\n    this.#nwsapi = initNwsapi(window, document);\n  }\n\n  /**\n   * matches\n   * @param {string} selector - CSS selector\n   * @param {object} node - Element node\n   * @param {object} opt - options\n   * @returns {boolean} - `true` if matched `false` otherwise\n   */\n  matches(selector, node, opt) {\n    if (!node?.nodeType) {\n      const e = new this.#window.TypeError(`Unexpected type ${getType(node)}`);\n      this.#finder.onError(e, opt);\n    } else if (node.nodeType !== ELEMENT_NODE) {\n      const e = new this.#window.TypeError(`Unexpected node ${node.nodeName}`);\n      this.#finder.onError(e, opt);\n    }\n    const document = node.ownerDocument;\n    if (document === this.#document && document.contentType === 'text/html') {\n      const filterOpt = {\n        complex: REG_COMPLEX.test(selector),\n        compound: false,\n        descend: false,\n        simple: false,\n        target: TARGET_SELF\n      };\n      if (filterSelector(selector, filterOpt)) {\n        try {\n          const res = this.#nwsapi.match(selector, node);\n          return res;\n        } catch (e) {\n          // fall through\n        }\n      }\n    }\n    let res;\n    try {\n      this.#finder.setup(selector, node, opt);\n      const nodes = this.#finder.find(TARGET_SELF);\n      res = nodes.size;\n    } catch (e) {\n      this.#finder.onError(e, opt);\n    }\n    return !!res;\n  }\n\n  /**\n   * closest\n   * @param {string} selector - CSS selector\n   * @param {object} node - Element node\n   * @param {object} opt - options\n   * @returns {?object} - matched node\n   */\n  closest(selector, node, opt) {\n    if (!node?.nodeType) {\n      const e = new this.#window.TypeError(`Unexpected type ${getType(node)}`);\n      this.#finder.onError(e, opt);\n    } else if (node.nodeType !== ELEMENT_NODE) {\n      const e = new this.#window.TypeError(`Unexpected node ${node.nodeName}`);\n      this.#finder.onError(e, opt);\n    }\n    const document = node.ownerDocument;\n    if (document === this.#document && document.contentType === 'text/html') {\n      const filterOpt = {\n        complex: REG_COMPLEX.test(selector),\n        compound: false,\n        descend: false,\n        simple: false,\n        target: TARGET_LINEAL\n      };\n      if (filterSelector(selector, filterOpt)) {\n        try {\n          const res = this.#nwsapi.closest(selector, node);\n          return res;\n        } catch (e) {\n          // fall through\n        }\n      }\n    }\n    let res;\n    try {\n      this.#finder.setup(selector, node, opt);\n      const nodes = this.#finder.find(TARGET_LINEAL);\n      if (nodes.size) {\n        let refNode = node;\n        while (refNode) {\n          if (nodes.has(refNode)) {\n            res = refNode;\n            break;\n          }\n          refNode = refNode.parentNode;\n        }\n      }\n    } catch (e) {\n      this.#finder.onError(e, opt);\n    }\n    return res ?? null;\n  }\n\n  /**\n   * query selector\n   * @param {string} selector - CSS selector\n   * @param {object} node - Document, DocumentFragment, Element node\n   * @param {object} opt - options\n   * @returns {?object} - matched node\n   */\n  querySelector(selector, node, opt) {\n    if (!node?.nodeType) {\n      const e = new this.#window.TypeError(`Unexpected type ${getType(node)}`);\n      this.#finder.onError(e, opt);\n    }\n    let document;\n    if (node.nodeType === DOCUMENT_NODE) {\n      document = node;\n    } else {\n      document = node.ownerDocument;\n    }\n    if (document === this.#document && document.contentType === 'text/html') {\n      const filterOpt = {\n        complex: false,\n        compound: !(REG_SIMPLE.test(selector) || REG_COMPLEX.test(selector)),\n        descend: REG_DESCEND.test(selector),\n        simple: REG_SIMPLE.test(selector),\n        target: TARGET_FIRST\n      };\n      if (filterSelector(selector, filterOpt)) {\n        try {\n          const res = this.#nwsapi.first(selector, node);\n          return res;\n        } catch (e) {\n          // fall through\n        }\n      }\n    }\n    let res;\n    try {\n      this.#finder.setup(selector, node, opt);\n      const nodes = this.#finder.find(TARGET_FIRST);\n      if (nodes.size) {\n        [res] = nodes;\n      }\n    } catch (e) {\n      this.#finder.onError(e, opt);\n    }\n    return res ?? null;\n  }\n\n  /**\n   * query selector all\n   * NOTE: returns Array, not NodeList\n   * @param {string} selector - CSS selector\n   * @param {object} node - Document, DocumentFragment, Element node\n   * @param {object} opt - options\n   * @returns {Array.<object|undefined>} - collection of matched nodes\n   */\n  querySelectorAll(selector, node, opt) {\n    if (!node?.nodeType) {\n      const e = new this.#window.TypeError(`Unexpected type ${getType(node)}`);\n      this.#finder.onError(e, opt);\n    }\n    let document;\n    if (node.nodeType === DOCUMENT_NODE) {\n      document = node;\n    } else {\n      document = node.ownerDocument;\n    }\n    if (document === this.#document && document.contentType === 'text/html') {\n      const filterOpt = {\n        complex: false,\n        compound: false,\n        descend: REG_DESCEND.test(selector),\n        simple: REG_SIMPLE.test(selector),\n        target: TARGET_ALL\n      };\n      if (filterSelector(selector, filterOpt)) {\n        try {\n          const res = this.#nwsapi.select(selector, node);\n          return res;\n        } catch (e) {\n          // fall through\n        }\n      }\n    }\n    let res;\n    try {\n      this.#finder.setup(selector, node, opt);\n      const nodes = this.#finder.find(TARGET_ALL);\n      if (nodes.size) {\n        res = [...nodes];\n      }\n    } catch (e) {\n      this.#finder.onError(e, opt);\n    }\n    return res ?? [];\n  }\n}\n"],
  "mappings": "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",
  "names": ["src_exports", "__export", "DOMSelector", "__toCommonJS", "import_finder", "import_utility", "import_constant", "REG_COMPLEX", "REG_DESCEND", "REG_SIMPLE", "#window", "#document", "#finder", "#nwsapi", "window", "document", "selector", "node", "opt", "e", "filterOpt", "res", "nodes", "refNode"]
}
