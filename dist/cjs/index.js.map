{
  "version": 3,
  "sources": ["../../src/index.js"],
  "sourcesContent": ["/*!\n * DOM Selector - A CSS selector engine.\n * @license MIT\n * @copyright asamuzaK (Kazz)\n * @see {@link https://github.com/asamuzaK/domSelector/blob/main/LICENSE}\n */\n\n/* import */\nimport { sortNodes } from './js/dom-util.js';\nimport { Finder } from './js/finder.js';\nimport { filterSelector, initNwsapi } from './js/nwsapi.js';\n\n/* constants */\nimport {\n  DOCUMENT_NODE, ELEMENT_NODE, REG_COMPLEX, TARGET_ALL, TARGET_FIRST,\n  TARGET_LINEAL, TARGET_SELF\n} from './js/constant.js';\n\nexport class DOMSelector extends Finder {\n  /* private fields */\n  #document;\n  #nwsapi;\n\n  /**\n   * construct\n   * @param {object} window - window\n   * @param {object} document - document\n   */\n  constructor(window, document) {\n    super(window, document);\n    this.#document = document ?? window.document;\n    this.#nwsapi = initNwsapi(this.#document);\n  }\n\n  /**\n   * matches\n   * @param {string} selector - CSS selector\n   * @param {object} node - Element node\n   * @param {object} opt - options\n   * @returns {boolean} - `true` if matched `false` otherwise\n   */\n  matches(selector, node, opt) {\n    let res;\n    try {\n      if (node?.nodeType !== ELEMENT_NODE) {\n        const msg = `Unexpected node ${node?.nodeName}`;\n        throw new TypeError(msg);\n      }\n      const document = node.ownerDocument;\n      if (document === this.#document && document.contentType === 'text/html') {\n        const filterOpt = {\n          complex: REG_COMPLEX.test(selector),\n          descendant: true,\n          target: TARGET_SELF\n        };\n        if (filterSelector(selector, filterOpt)) {\n          return this.#nwsapi.match(selector, node);\n        }\n      }\n      this._setup(selector, node, opt);\n      const nodes = this._find(TARGET_SELF);\n      res = nodes.size;\n    } catch (e) {\n      this._onError(e);\n    }\n    return !!res;\n  }\n\n  /**\n   * closest\n   * @param {string} selector - CSS selector\n   * @param {object} node - Element node\n   * @param {object} opt - options\n   * @returns {?object} - matched node\n   */\n  closest(selector, node, opt) {\n    let res;\n    try {\n      if (node?.nodeType !== ELEMENT_NODE) {\n        const msg = `Unexpected node ${node?.nodeName}`;\n        throw new TypeError(msg);\n      }\n      const document = node.ownerDocument;\n      if (document === this.#document && document.contentType === 'text/html') {\n        const filterOpt = {\n          complex: REG_COMPLEX.test(selector),\n          descendant: true,\n          target: TARGET_LINEAL\n        };\n        if (filterSelector(selector, filterOpt)) {\n          return this.#nwsapi.closest(selector, node);\n        }\n      }\n      this._setup(selector, node, opt);\n      const nodes = this._find(TARGET_LINEAL);\n      if (nodes.size) {\n        let refNode = node;\n        while (refNode) {\n          if (nodes.has(refNode)) {\n            res = refNode;\n            break;\n          }\n          refNode = refNode.parentNode;\n        }\n      }\n    } catch (e) {\n      this._onError(e);\n    }\n    return res ?? null;\n  }\n\n  /**\n   * query selector\n   * @param {string} selector - CSS selector\n   * @param {object} node - Document, DocumentFragment, Element node\n   * @param {object} opt - options\n   * @returns {?object} - matched node\n   */\n  querySelector(selector, node, opt) {\n    let res;\n    try {\n      let document;\n      if (node?.nodeType === DOCUMENT_NODE) {\n        document = node;\n      } else {\n        document = node?.ownerDocument;\n      }\n      if (document === this.#document &&\n          document?.contentType === 'text/html') {\n        const filterOpt = {\n          complex: false,\n          descendant: false,\n          target: TARGET_FIRST\n        };\n        if (filterSelector(selector, filterOpt)) {\n          return this.#nwsapi.first(selector, node);\n        }\n      }\n      this._setup(selector, node, opt);\n      const nodes = this._find(TARGET_FIRST);\n      nodes.delete(node);\n      if (nodes.size) {\n        [res] = sortNodes(nodes);\n      }\n    } catch (e) {\n      this._onError(e);\n    }\n    return res ?? null;\n  }\n\n  /**\n   * query selector all\n   * NOTE: returns Array, not NodeList\n   * @param {string} selector - CSS selector\n   * @param {object} node - Document, DocumentFragment, Element node\n   * @param {object} opt - options\n   * @returns {Array.<object|undefined>} - collection of matched nodes\n   */\n  querySelectorAll(selector, node, opt) {\n    let res;\n    try {\n      let document;\n      if (node?.nodeType === DOCUMENT_NODE) {\n        document = node;\n      } else {\n        document = node?.ownerDocument;\n      }\n      if (document === this.#document &&\n          document?.contentType === 'text/html') {\n        const filterOpt = {\n          complex: false,\n          descendant: true,\n          target: TARGET_ALL\n        };\n        if (filterSelector(selector, filterOpt)) {\n          return this.#nwsapi.select(selector, node);\n        }\n      }\n      this._setup(selector, node, opt);\n      const nodes = this._find(TARGET_ALL);\n      nodes.delete(node);\n      if (nodes.size) {\n        res = [...nodes];\n      }\n    } catch (e) {\n      this._onError(e);\n    }\n    return res ?? [];\n  }\n}\n"],
  "mappings": "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",
  "names": ["src_exports", "__export", "DOMSelector", "__toCommonJS", "import_dom_util", "import_finder", "import_nwsapi", "import_constant", "#document", "#nwsapi", "window", "document", "selector", "node", "opt", "res", "msg", "filterOpt", "e", "nodes", "refNode"]
}
