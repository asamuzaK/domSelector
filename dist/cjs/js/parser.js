var g=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var T=(n,t)=>{for(var s in t)g(n,s,{get:t[s],enumerable:!0})},$=(n,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of S(t))!I.call(n,i)&&i!==s&&g(n,i,{get:()=>t[i],enumerable:!(r=L(t,i))||r.enumerable});return n};var C=n=>$(g({},"__esModule",{value:!0}),n);var R={};T(R,{filterSelector:()=>D,generateCSS:()=>_.generate,parseAstName:()=>m,parseSelector:()=>u,preprocess:()=>O,sortAST:()=>A,unescapeSelector:()=>w,walkAST:()=>y});module.exports=C(R);var d=require("css-tree"),e=require("./constant.js"),_=require("css-tree");const w=(n="")=>{if(typeof n=="string"&&n.indexOf("\\",0)>=0){const t=n.split("\\"),s=t.length;for(let r=1;r<s;r++){let i=t[r];if(i===""&&r===s-1)i=e.U_FFFD;else{const f=e.REG_HEX.exec(i);if(f){const[,o]=f;let a;try{const c=parseInt("D800",e.HEX),E=parseInt("DFFF",e.HEX),l=parseInt(o,e.HEX);l===0||l>=c&&l<=E?a=e.U_FFFD:a=String.fromCodePoint(l)}catch{a=e.U_FFFD}let p="";i.length>o.length&&(p=i.substring(o.length)),i=`${a}${p}`}else/^[\n\r\f]/.test(i)&&(i="\\"+i)}t[r]=i}n=t.join("")}return n},O=(...n)=>{if(!n.length)throw new TypeError("1 argument required, but only 0 present.");let[t]=n;if(typeof t=="string"){let s=0;for(;s>=0&&(s=t.indexOf("#",s),!(s<0));){const r=t.substring(0,s+1);let i=t.substring(s+1);if(/^\d$/.test(i.substring(0,1)))throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR);const f=i.codePointAt(0);if(f===e.BIT_HYPHEN){if(/^\d$/.test(i.substring(1,2)))throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR)}else if(f>e.BIT_FFFF){const o=`\\${f.toString(e.HEX)} `;i.length===e.DUO?i=o:i=`${o}${i.substring(e.DUO)}`}t=`${r}${i}`,s++}t=t.replace(/\f|\r\n?/g,`
`).replace(/[\0\uD800-\uDFFF]|\\$/g,e.U_FFFD)}else if(t==null)t=Object.prototype.toString.call(t).slice(e.TYPE_FROM,e.TYPE_TO).toLowerCase();else if(Array.isArray(t))t=t.join(",");else if(Object.prototype.hasOwnProperty.call(t,"toString"))t=t.toString();else throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR);return t},u=n=>{if(n=O(n),e.REG_INVALID_SELECTOR.test(n))throw new DOMException(`Invalid selector ${n}`,e.SYNTAX_ERR);let t;try{const s=(0,d.parse)(n,{context:"selectorList",parseCustomProperty:!0});t=(0,d.toPlainObject)(s)}catch(s){const{message:r}=s;if(r==="Identifier is expected"&&e.REG_LANG_QUOTED.test(n)){const[,i,f]=e.REG_LANG_QUOTED.exec(n),o=f.replaceAll("*","\\*").replace(/^"/,"").replace(/"$/,"");let a=i.replace(f,o);a===":lang()"&&(a=`:lang(${e.EMPTY})`),t=u(n.replace(i,a))}else if(/^(?:Identifier|Selector) is expected$/.test(r)&&e.REG_LOGICAL_EMPTY.test(n)){const[,i,f]=e.REG_LOGICAL_EMPTY.exec(n);t=u(n.replace(i,`:${f}(${e.EMPTY})`))}else if(/^(?:"\]"|Attribute selector [()\s,=~^$*|]+) is expected$/.test(r)&&!n.endsWith("]")){const i=n.lastIndexOf("["),f=n.substring(i);f.includes('"')?f.match(/"/g).length%2?t=u(`${n}"]`):t=u(`${n}]`):t=u(`${n}]`)}else if(r==='")" is expected'&&!n.endsWith(")"))t=u(`${n})`);else throw new DOMException(r,e.SYNTAX_ERR)}return t},y=(n={})=>{const t=new Set;let s,r;(0,d.walk)(n,{enter:o=>{o.type===e.SELECTOR?t.add(o.children):o.type===e.SELECTOR_PSEUDO_CLASS?(s=!0,e.REG_LOGICAL_PSEUDO.test(o.name)&&(r=!0)):o.type===e.SELECTOR_PSEUDO_ELEMENT&&(s=!0,e.REG_SHADOW_PSEUDO.test(o.name)&&(r=!0))}}),r&&(0,d.findAll)(n,(o,a,p)=>{if(p){if(o.type===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(o.name)){const c=p.filter(E=>{const{name:l,type:h}=E;return h===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(l)});for(const{children:E}of c)for(const{children:l}of E)for(const{children:h}of l)t.has(h)&&t.delete(h)}else if(o.type===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(o.name)){const c=p.filter(E=>{const{name:l,type:h}=E;return h===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(l)});for(const{children:E}of c)for(const{children:l}of E)t.has(l)&&t.delete(l)}}});const f={};return s&&(f.hasPseudo=s),r&&(f.hasPseudoFunc=r),{info:f,branches:[...t]}},A=n=>{const t=[...n];if(t.length>1){const s=new Map([[e.SELECTOR_PSEUDO_ELEMENT,e.BIT_01],[e.SELECTOR_ID,e.BIT_02],[e.SELECTOR_CLASS,e.BIT_04],[e.SELECTOR_TYPE,e.BIT_08],[e.SELECTOR_ATTR,e.BIT_16],[e.SELECTOR_PSEUDO_CLASS,e.BIT_32]]);t.sort((r,i)=>{const{type:f}=r,{type:o}=i,a=s.get(f),p=s.get(o);let c;return a===p?c=0:a>p?c=1:c=-1,c})}return t},m=n=>{let t,s;if(n&&typeof n=="string")n.indexOf("|")>-1?[t,s]=n.split("|"):(t="*",s=n);else throw new DOMException(`Invalid selector ${n}`,e.SYNTAX_ERR);return{prefix:t,localName:s}},D=(n,t={})=>{if(!n||typeof n!="string")return!1;if(n.includes("[")){const s=n.lastIndexOf("[");if(n.substring(s).lastIndexOf("]")<0)return!1}if(/\||::|\[\s*[\w$*=^|~-]+(?:(?:"[\w$*=^|~\s'-]+"|'[\w$*=^|~\s"-]+')?(?:\s+[\w$*=^|~-]+)+|"[^"\]]{1,255}|'[^'\]]{1,255})\s*\]/.test(n))return!1;if(n.includes(":")){let s;if(e.REG_LOGICAL_KEY.test(n)){if(e.REG_LOGICAL_EMPTY.test(n))return!1;const{complex:r,descendant:i}=t;r&&i?s=e.REG_LOGICAL_COMPLEX_A:r?s=e.REG_LOGICAL_COMPLEX_B:s=e.REG_LOGICAL_COMPOUND}else s=e.REG_CHILD_INDEXED;if(s.test(n))return!1}return!0};0&&(module.exports={filterSelector,generateCSS,parseAstName,parseSelector,preprocess,sortAST,unescapeSelector,walkAST});
//# sourceMappingURL=parser.js.map
