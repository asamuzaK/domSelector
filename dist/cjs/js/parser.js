var S=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var A=(r,t)=>{for(var n in t)S(r,n,{get:t[n],enumerable:!0})},$=(r,t,n,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of _(t))!w.call(r,s)&&s!==n&&S(r,s,{get:()=>t[s],enumerable:!(c=O(t,s))||c.enumerable});return r};var C=r=>$(S({},"__esModule",{value:!0}),r);var D={};A(D,{findAST:()=>E.find,generateCSS:()=>E.generate,parseAstName:()=>I,parseSelector:()=>u,preprocess:()=>x,sortAST:()=>F,unescapeSelector:()=>b,walkAST:()=>L});module.exports=C(D);var d=require("css-tree"),T=require("./utility.js"),e=require("./constant.js"),E=require("css-tree");const m=/(?<=:(?:dir|has|host(?:-context)?|is|lang|not|nth-(?:last-)?(?:child|of-type)|where))\(\s+\)/g,y=/^part|slotted$/,g="\uFFFD",b=(r="")=>{if(typeof r=="string"&&r.indexOf("\\",0)>=0){const t=r.split("\\"),n=t.length;for(let c=1;c<n;c++){let s=t[c];if(s===""&&c===n-1)s=g;else{const h=/^([\da-f]{1,6}\s?)/i.exec(s);if(h){const[,l]=h;let a;try{const i=parseInt("D800",e.HEX),f=parseInt("DFFF",e.HEX),p=parseInt(l,e.HEX);p===0||p>=i&&p<=f?a=g:a=String.fromCodePoint(p)}catch{a=g}let o="";s.length>l.length&&(o=s.substring(l.length)),s=`${a}${o}`}else/^[\n\r\f]/.test(s)&&(s="\\"+s)}t[c]=s}r=t.join("")}return r},x=(...r)=>{if(!r.length)throw new TypeError("1 argument required, but only 0 present.");let[t]=r;if(typeof t=="string"){let n=0;for(;n>=0&&(n=t.indexOf("#",n),!(n<0));){const c=t.substring(0,n+1);let s=t.substring(n+1);if(/^\d$/.test(s.substring(0,1)))throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR);const h=s.codePointAt(0);if(h===e.HYPHEN){if(/^\d$/.test(s.substring(1,2)))throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR)}else if(h>e.BIT_FFFF){const l=`\\${h.toString(e.HEX)} `;s.length===e.DUO?s=l:s=`${l}${s.substring(e.DUO)}`}t=`${c}${s}`,n++}t=t.replace(/\f|\r\n?/g,`
`).replace(/[\0\uD800-\uDFFF]|\\$/g,g)}else if(t==null)t=(0,T.getType)(t).toLowerCase();else if(Array.isArray(t))t=t.join(",");else if(Object.prototype.hasOwnProperty.call(t,"toString"))t=t.toString();else throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR);return t},u=r=>{if(r=x(r),/^$|^\s*>|,\s*$/.test(r))throw new DOMException(`Invalid selector ${r}`,e.SYNTAX_ERR);let t;try{const n=(0,d.parse)(r,{context:"selectorList",parseCustomProperty:!0});t=(0,d.toPlainObject)(n)}catch(n){const{message:c}=n;if(/^(?:"\]"|Attribute selector [()\s,=~^$*|]+) is expected$/.test(c)&&!r.endsWith("]")){const s=r.lastIndexOf("["),h=r.substring(s);h.includes('"')?h.match(/"/g).length%2?t=u(`${r}"]`):t=u(`${r}]`):t=u(`${r}]`)}else if(c==='")" is expected')if(m.test(r))t=u(`${r.replaceAll(m,"()")}`);else if(!r.endsWith(")"))t=u(`${r})`);else throw new DOMException(c,e.SYNTAX_ERR);else throw new DOMException(c,e.SYNTAX_ERR)}return t},L=(r={})=>{const t=new Set,n=new Map;return(0,d.walk)(r,{enter:s=>{switch(s.type){case e.SELECTOR:{t.add(s.children);break}case e.PS_CLASS_SELECTOR:{e.KEY_LOGICAL.includes(s.name)?(n.set("hasNestedSelector",!0),n.set("hasLogicalPseudoFunc",!0),s.name==="has"&&n.set("hasHasPseudoFunc",!0)):e.KEY_PS_STATE.includes(s.name)?n.set("hasStatePseudoClass",!0):e.KEY_SHADOW_HOST.includes(s.name)&&Array.isArray(s.children)&&s.children.length&&n.set("hasNestedSelector",!0);break}case e.PS_ELEMENT_SELECTOR:{y.test(s.name)&&n.set("hasNestedSelector",!0);break}case e.NTH:{s.selector&&(n.set("hasNestedSelector",!0),n.set("hasNthChildOfSelector",!0));break}default:}}}),n.get("hasNestedSelector")&&(0,d.findAll)(r,(s,h,l)=>{if(l){if(s.type===e.PS_CLASS_SELECTOR&&e.KEY_LOGICAL.includes(s.name)){const a=l.filter(o=>{const{name:i,type:f}=o;return f===e.PS_CLASS_SELECTOR&&e.KEY_LOGICAL.includes(i)});for(const{children:o}of a)for(const{children:i}of o)for(const{children:f}of i)t.has(f)&&t.delete(f)}else if(s.type===e.PS_CLASS_SELECTOR&&e.KEY_SHADOW_HOST.includes(s.name)&&Array.isArray(s.children)&&s.children.length){const a=l.filter(o=>{const{children:i,name:f,type:p}=o;return p===e.PS_CLASS_SELECTOR&&e.KEY_SHADOW_HOST.includes(f)&&Array.isArray(i)&&i.length});for(const{children:o}of a)for(const{children:i}of o)t.has(i)&&t.delete(i)}else if(s.type===e.PS_ELEMENT_SELECTOR&&y.test(s.name)){const a=l.filter(o=>{const{name:i,type:f}=o;return f===e.PS_ELEMENT_SELECTOR&&y.test(i)});for(const{children:o}of a)for(const{children:i}of o)t.has(i)&&t.delete(i)}else if(s.type===e.NTH&&s.selector){const a=l.filter(o=>{const{selector:i,type:f}=o;return f===e.NTH&&i});for(const{selector:o}of a){const{children:i}=o;for(const{children:f}of i)t.has(f)&&t.delete(f)}}}}),{branches:[...t],info:Object.fromEntries(n)}},F=r=>{const t=[...r];if(t.length>1){const n=new Map([[e.PS_ELEMENT_SELECTOR,e.BIT_01],[e.ID_SELECTOR,e.BIT_02],[e.CLASS_SELECTOR,e.BIT_04],[e.TYPE_SELECTOR,e.BIT_08],[e.ATTR_SELECTOR,e.BIT_16],[e.PS_CLASS_SELECTOR,e.BIT_32]]);t.sort((c,s)=>{const{type:h}=c,{type:l}=s,a=n.get(h),o=n.get(l);let i;return a===o?i=0:a>o?i=1:i=-1,i})}return t},I=r=>{let t,n;if(r&&typeof r=="string")r.indexOf("|")>-1?[t,n]=r.split("|"):(t="*",n=r);else throw new DOMException(`Invalid selector ${r}`,e.SYNTAX_ERR);return{prefix:t,localName:n}};0&&(module.exports={findAST,generateCSS,parseAstName,parseSelector,preprocess,sortAST,unescapeSelector,walkAST});
//# sourceMappingURL=parser.js.map
