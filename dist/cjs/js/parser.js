var u=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var w=(n,t)=>{for(var r in t)u(n,r,{get:t[r],enumerable:!0})},T=(n,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of x(t))!y.call(n,s)&&s!==r&&u(n,s,{get:()=>t[s],enumerable:!(i=O(t,s))||i.enumerable});return n};var m=n=>T(u({},"__esModule",{value:!0}),n);var C={};w(C,{filterSelector:()=>A,generateCSS:()=>S.generate,parseAstName:()=>$,parseSelector:()=>g,preprocess:()=>E,sortAST:()=>L,unescapeSelector:()=>_,walkAST:()=>I});module.exports=m(C);var h=require("css-tree"),e=require("./constant.js"),S=require("css-tree");const _=(n="")=>{if(typeof n=="string"&&n.indexOf("\\",0)>=0){const t=n.split("\\"),r=t.length;for(let i=1;i<r;i++){let s=t[i];if(s===""&&i===r-1)s=e.U_FFFD;else{const c=/^([\da-f]{1,6}\s?)/i.exec(s);if(c){const[,a]=c;let f;try{const o=parseInt("D800",e.HEX),p=parseInt("DFFF",e.HEX),d=parseInt(a,e.HEX);d===0||d>=o&&d<=p?f=e.U_FFFD:f=String.fromCodePoint(d)}catch{f=e.U_FFFD}let l="";s.length>a.length&&(l=s.substring(a.length)),s=`${f}${l}`}else/^[\n\r\f]/.test(s)&&(s="\\"+s)}t[i]=s}n=t.join("")}return n},E=(...n)=>{if(!n.length)throw new TypeError("1 argument required, but only 0 present.");let[t]=n;if(typeof t=="string"){let r=0;for(;r>=0&&(r=t.indexOf("#",r),!(r<0));){const i=t.substring(0,r+1);let s=t.substring(r+1);const c=s.codePointAt(0);if(c===e.BIT_HYPHEN){if(/^\d$/.test(s.substring(1,2)))throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR)}else if(c>e.BIT_FFFF){const a=`\\${c.toString(e.HEX)} `;s.length===e.DUO?s=a:s=`${a}${s.substring(e.DUO)}`}t=`${i}${s}`,r++}t=t.replace(/\f|\r\n?/g,`
`).replace(/[\0\uD800-\uDFFF]|\\$/g,e.U_FFFD)}else if(t==null)t=Object.prototype.toString.call(t).slice(e.TYPE_FROM,e.TYPE_TO).toLowerCase();else if(Array.isArray(t))t=t.join(",");else if(Object.prototype.hasOwnProperty.call(t,"toString"))t=t.toString();else throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR);return t},g=n=>{if(n=E(n),/^$|^\s*>|,\s*$/.test(n))throw new DOMException(`Invalid selector ${n}`,e.SYNTAX_ERR);let t;try{const r=(0,h.parse)(n,{context:"selectorList",parseCustomProperty:!0});t=(0,h.toPlainObject)(r)}catch(r){const i=/(:lang\(\s*("[A-Za-z\d\-*]+")\s*\))/;if(r.message==="Identifier is expected"&&i.test(n)){const[,s,c]=i.exec(n),a=c.replaceAll("*","\\*").replace(/^"/,"").replace(/"$/,""),f=s.replace(c,a);t=g(n.replace(s,f))}else if(r.message==='"]" is expected'&&!n.endsWith("]"))t=g(`${n}]`);else if(r.message==='")" is expected'&&!n.endsWith(")"))t=g(`${n})`);else throw new DOMException(r.message,e.SYNTAX_ERR)}return t},I=(n={})=>{const t=new Set;let r;return(0,h.walk)(n,{enter:s=>{s.type===e.SELECTOR?t.add(s.children):(s.type===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(s.name)||s.type===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(s.name))&&(r=!0)}}),r&&(0,h.findAll)(n,(s,c,a)=>{if(a){if(s.type===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(s.name)){const f=a.filter(l=>{const{name:o,type:p}=l;return p===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(o)});for(const{children:l}of f)for(const{children:o}of l)for(const{children:p}of o)t.has(p)&&t.delete(p)}else if(s.type===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(s.name)){const f=a.filter(l=>{const{name:o,type:p}=l;return p===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(o)});for(const{children:l}of f)for(const{children:o}of l)t.has(o)&&t.delete(o)}}}),[...t]},L=n=>{const t=[...n];if(t.length>1){const r=new Map([[e.SELECTOR_PSEUDO_ELEMENT,e.BIT_01],[e.SELECTOR_ID,e.BIT_02],[e.SELECTOR_CLASS,e.BIT_04],[e.SELECTOR_TYPE,e.BIT_08],[e.SELECTOR_ATTR,e.BIT_16],[e.SELECTOR_PSEUDO_CLASS,e.BIT_32]]);t.sort((i,s)=>{const{type:c}=i,{type:a}=s,f=r.get(c),l=r.get(a);let o;return f===l?o=0:f>l?o=1:o=-1,o})}return t},$=n=>{let t,r;if(n&&typeof n=="string")n.indexOf("|")>-1?[t,r]=n.split("|"):(t="*",r=n);else throw new DOMException(`Invalid selector ${n}`,e.SYNTAX_ERR);return{prefix:t,localName:r}},A=n=>!(!n||typeof n!="string"||/\||::|\s[is]\s*\]/i.test(n)||n.includes(":")&&(/:(?!(?:nth(?:-last)?|first|last|only)-(?:of-type|child)|not)/.test(n)||n.includes(":nth")&&/:nth-(?:last-)?child\(.{1,255}\sof.{1,255}\)/.test(n)||n.includes(":not")&&!/:not\(\s*(?:\*|[\w-]{1,255}|(?:\*|[\w-]{1,255})?(?:\[.{1,255}\]|[.#:][\w-]{1,255}){1,255})(?:\s*,\s*(?:\*|[\w-]{1,255}|(?:\*|[\w-]{1,255})?(?:\[.{1,255}\]|[.#:][\w-]{1,255}){1,255})){0,255}\s*\)/.test(n)));0&&(module.exports={filterSelector,generateCSS,parseAstName,parseSelector,preprocess,sortAST,unescapeSelector,walkAST});
//# sourceMappingURL=parser.js.map
