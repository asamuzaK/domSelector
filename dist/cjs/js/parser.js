var O=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var C=(n,t)=>{for(var s in t)O(n,s,{get:t[s],enumerable:!0})},L=(n,t,s,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of I(t))!y.call(n,r)&&r!==s&&O(n,r,{get:()=>t[r],enumerable:!(o=$(t,r))||o.enumerable});return n};var T=n=>L(O({},"__esModule",{value:!0}),n);var P={};C(P,{filterSelector:()=>R,generateCSS:()=>_.generate,parseAstName:()=>D,parseSelector:()=>h,preprocess:()=>x,sortAST:()=>A,unescapeSelector:()=>m,walkAST:()=>w});module.exports=T(P);var g=require("css-tree"),e=require("./constant.js"),_=require("css-tree");const m=(n="")=>{if(typeof n=="string"&&n.indexOf("\\",0)>=0){const t=n.split("\\"),s=t.length;for(let o=1;o<s;o++){let r=t[o];if(r===""&&o===s-1)r=e.U_FFFD;else{const p=/^([\da-f]{1,6}\s?)/i.exec(r);if(p){const[,i]=p;let l;try{const c=parseInt("D800",e.HEX),d=parseInt("DFFF",e.HEX),f=parseInt(i,e.HEX);f===0||f>=c&&f<=d?l=e.U_FFFD:l=String.fromCodePoint(f)}catch{l=e.U_FFFD}let a="";r.length>i.length&&(a=r.substring(i.length)),r=`${l}${a}`}else/^[\n\r\f]/.test(r)&&(r="\\"+r)}t[o]=r}n=t.join("")}return n},x=(...n)=>{if(!n.length)throw new TypeError("1 argument required, but only 0 present.");let[t]=n;if(typeof t=="string"){let s=0;for(;s>=0&&(s=t.indexOf("#",s),!(s<0));){const o=t.substring(0,s+1);let r=t.substring(s+1);if(/^\d$/.test(r.substring(0,1)))throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR);const p=r.codePointAt(0);if(p===e.BIT_HYPHEN){if(/^\d$/.test(r.substring(1,2)))throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR)}else if(p>e.BIT_FFFF){const i=`\\${p.toString(e.HEX)} `;r.length===e.DUO?r=i:r=`${i}${r.substring(e.DUO)}`}t=`${o}${r}`,s++}t=t.replace(/\f|\r\n?/g,`
`).replace(/[\0\uD800-\uDFFF]|\\$/g,e.U_FFFD)}else if(t==null)t=Object.prototype.toString.call(t).slice(e.TYPE_FROM,e.TYPE_TO).toLowerCase();else if(Array.isArray(t))t=t.join(",");else if(Object.prototype.hasOwnProperty.call(t,"toString"))t=t.toString();else throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR);return t},h=n=>{if(n=x(n),/^$|^\s*>|,\s*$/.test(n))throw new DOMException(`Invalid selector ${n}`,e.SYNTAX_ERR);let t;try{const s=(0,g.parse)(n,{context:"selectorList",parseCustomProperty:!0});t=(0,g.toPlainObject)(s)}catch(s){const{message:o}=s,r=/(:(is|where)\(\s*\))/,p=/(:lang\(\s*("[A-Za-z\d\-*]*")\s*\))/;if(o==="Identifier is expected"&&p.test(n)){const[,i,l]=p.exec(n),a=l.replaceAll("*","\\*").replace(/^"/,"").replace(/"$/,"");let c=i.replace(l,a);c===":lang()"&&(c=`:lang(${e.EMPTY})`),t=h(n.replace(i,c))}else if((o==="Identifier is expected"||o==="Selector is expected")&&r.test(n)){const[,i,l]=r.exec(n),a=`:${l}(${e.EMPTY})`;t=h(n.replace(i,a))}else if(/^(?:"\]"|Attribute selector [()\s,=~^$*|]+) is expected$/.test(o)&&!n.endsWith("]")){const i=n.lastIndexOf("["),l=n.substring(i);l.includes('"')?l.match(/"/g).length%2?t=h(`${n}"]`):t=h(`${n}]`):t=h(`${n}]`)}else if(o==='")" is expected'&&!n.endsWith(")"))t=h(`${n})`);else throw new DOMException(o,e.SYNTAX_ERR)}return t},w=(n={},t=!1)=>{const s=new Set;let o,r;return(0,g.walk)(n,{enter:i=>{i.type===e.SELECTOR?s.add(i.children):(i.type===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(i.name)||i.type===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(i.name))&&(o=!0)}}),o&&(0,g.findAll)(n,(i,l,a)=>{if(a){if(i.type===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(i.name)){const c=a.filter(d=>{const{name:f,type:E}=d;return E===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(f)});for(const{children:d}of c)for(const{children:f}of d)for(const{children:E}of f)if(s.has(E)){if(t)for(const u of E){const{type:S}=u;if(S===e.COMBINATOR){r=!0;break}}else r=!1;s.delete(E)}}else if(i.type===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(i.name)){const c=a.filter(d=>{const{name:f,type:E}=d;return E===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(f)});for(const{children:d}of c)for(const{children:f}of d)s.has(f)&&s.delete(f)}}}),{branches:[...s],complex:r}},A=n=>{const t=[...n];if(t.length>1){const s=new Map([[e.SELECTOR_PSEUDO_ELEMENT,e.BIT_01],[e.SELECTOR_ID,e.BIT_02],[e.SELECTOR_CLASS,e.BIT_04],[e.SELECTOR_TYPE,e.BIT_08],[e.SELECTOR_ATTR,e.BIT_16],[e.SELECTOR_PSEUDO_CLASS,e.BIT_32]]);t.sort((o,r)=>{const{type:p}=o,{type:i}=r,l=s.get(p),a=s.get(i);let c;return l===a?c=0:l>a?c=1:c=-1,c})}return t},D=n=>{let t,s;if(n&&typeof n=="string")n.indexOf("|")>-1?[t,s]=n.split("|"):(t="*",s=n);else throw new DOMException(`Invalid selector ${n}`,e.SYNTAX_ERR);return{prefix:t,localName:s}},R=(n,t={})=>{if(!n||typeof n!="string"||/\||::|\[\s*[\w$*=^|~-]+(?:(?:"[\w$*=^|~\s'-]+"|'[\w$*=^|~\s"-]+')?(?:\s+[\w$*=^|~-]+)+|"[^"\]]{1,255}|'[^'\]]{1,255})\s*\]/.test(n))return!1;if(n.includes(":")){let s;if(e.REG_LOGICAL_KEY.test(n)){const{complex:o,descendant:r}=t;o&&r?s=e.REG_LOGICAL_COMPLEX_A:o?s=e.REG_LOGICAL_COMPLEX_B:s=e.REG_LOGICAL_COMPOUND}else s=e.REG_CHILD_INDEXED;if(s.test(n))return!1}return!0};0&&(module.exports={filterSelector,generateCSS,parseAstName,parseSelector,preprocess,sortAST,unescapeSelector,walkAST});
//# sourceMappingURL=parser.js.map
