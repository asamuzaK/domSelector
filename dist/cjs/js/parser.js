var u=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var S=(n,t)=>{for(var i in t)u(n,i,{get:t[i],enumerable:!0})},I=(n,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of x(t))!L.call(n,s)&&s!==i&&u(n,s,{get:()=>t[s],enumerable:!(r=h(t,s))||r.enumerable});return n};var T=n=>I(u({},"__esModule",{value:!0}),n);var m={};S(m,{filterSelector:()=>A,generateCSS:()=>_.generate,parseAstName:()=>y,parseSelector:()=>d,preprocess:()=>O,sortAST:()=>w,unescapeSelector:()=>$,walkAST:()=>C});module.exports=T(m);var E=require("css-tree"),e=require("./constant.js"),_=require("css-tree");const $=(n="")=>{if(typeof n=="string"&&n.indexOf("\\",0)>=0){const t=n.split("\\"),i=t.length;for(let r=1;r<i;r++){let s=t[r];if(s===""&&r===i-1)s=e.U_FFFD;else{const o=e.REG_HEX.exec(s);if(o){const[,l]=o;let a;try{const f=parseInt("D800",e.HEX),p=parseInt("DFFF",e.HEX),g=parseInt(l,e.HEX);g===0||g>=f&&g<=p?a=e.U_FFFD:a=String.fromCodePoint(g)}catch{a=e.U_FFFD}let c="";s.length>l.length&&(c=s.substring(l.length)),s=`${a}${c}`}else/^[\n\r\f]/.test(s)&&(s="\\"+s)}t[r]=s}n=t.join("")}return n},O=(...n)=>{if(!n.length)throw new TypeError("1 argument required, but only 0 present.");let[t]=n;if(typeof t=="string"){let i=0;for(;i>=0&&(i=t.indexOf("#",i),!(i<0));){const r=t.substring(0,i+1);let s=t.substring(i+1);if(/^\d$/.test(s.substring(0,1)))throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR);const o=s.codePointAt(0);if(o===e.BIT_HYPHEN){if(/^\d$/.test(s.substring(1,2)))throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR)}else if(o>e.BIT_FFFF){const l=`\\${o.toString(e.HEX)} `;s.length===e.DUO?s=l:s=`${l}${s.substring(e.DUO)}`}t=`${r}${s}`,i++}t=t.replace(/\f|\r\n?/g,`
`).replace(/[\0\uD800-\uDFFF]|\\$/g,e.U_FFFD)}else if(t==null)t=Object.prototype.toString.call(t).slice(e.TYPE_FROM,e.TYPE_TO).toLowerCase();else if(Array.isArray(t))t=t.join(",");else if(Object.prototype.hasOwnProperty.call(t,"toString"))t=t.toString();else throw new DOMException(`Invalid selector ${t}`,e.SYNTAX_ERR);return t},d=n=>{if(n=O(n),e.REG_INVALID_SELECTOR.test(n))throw new DOMException(`Invalid selector ${n}`,e.SYNTAX_ERR);let t;try{const i=(0,E.parse)(n,{context:"selectorList",parseCustomProperty:!0});t=(0,E.toPlainObject)(i)}catch(i){const{message:r}=i;if(r==="Identifier is expected"&&e.REG_LANG_QUOTED.test(n)){const[,s,o]=e.REG_LANG_QUOTED.exec(n),l=o.replaceAll("*","\\*").replace(/^"/,"").replace(/"$/,"");let a=s.replace(o,l);a===":lang()"&&(a=`:lang(${e.EMPTY})`),t=d(n.replace(s,a))}else if(/^(?:Identifier|Selector) is expected$/.test(r)&&e.REG_LOGICAL_EMPTY.test(n)){const[,s,o]=e.REG_LOGICAL_EMPTY.exec(n);t=d(n.replace(s,`:${o}(${e.EMPTY})`))}else if(/^(?:"\]"|Attribute selector [()\s,=~^$*|]+) is expected$/.test(r)&&!n.endsWith("]")){const s=n.lastIndexOf("["),o=n.substring(s);o.includes('"')?o.match(/"/g).length%2?t=d(`${n}"]`):t=d(`${n}]`):t=d(`${n}]`)}else if(r==='")" is expected'&&!n.endsWith(")"))t=d(`${n})`);else throw new DOMException(r,e.SYNTAX_ERR)}return t},C=(n={})=>{const t=new Set;let i;return(0,E.walk)(n,{enter:s=>{s.type===e.SELECTOR?t.add(s.children):(s.type===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(s.name)||s.type===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(s.name))&&(i=!0)}}),i&&(0,E.findAll)(n,(s,o,l)=>{if(l){if(s.type===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(s.name)){const a=l.filter(c=>{const{name:f,type:p}=c;return p===e.SELECTOR_PSEUDO_CLASS&&e.REG_LOGICAL_PSEUDO.test(f)});for(const{children:c}of a)for(const{children:f}of c)for(const{children:p}of f)t.has(p)&&t.delete(p)}else if(s.type===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(s.name)){const a=l.filter(c=>{const{name:f,type:p}=c;return p===e.SELECTOR_PSEUDO_ELEMENT&&e.REG_SHADOW_PSEUDO.test(f)});for(const{children:c}of a)for(const{children:f}of c)t.has(f)&&t.delete(f)}}}),[...t]},w=n=>{const t=[...n];if(t.length>1){const i=new Map([[e.SELECTOR_PSEUDO_ELEMENT,e.BIT_01],[e.SELECTOR_ID,e.BIT_02],[e.SELECTOR_CLASS,e.BIT_04],[e.SELECTOR_TYPE,e.BIT_08],[e.SELECTOR_ATTR,e.BIT_16],[e.SELECTOR_PSEUDO_CLASS,e.BIT_32]]);t.sort((r,s)=>{const{type:o}=r,{type:l}=s,a=i.get(o),c=i.get(l);let f;return a===c?f=0:a>c?f=1:f=-1,f})}return t},y=n=>{let t,i;if(n&&typeof n=="string")n.indexOf("|")>-1?[t,i]=n.split("|"):(t="*",i=n);else throw new DOMException(`Invalid selector ${n}`,e.SYNTAX_ERR);return{prefix:t,localName:i}},A=(n,t={})=>{if(!n||typeof n!="string")return!1;if(n.includes("[")){const i=n.lastIndexOf("[");if(n.substring(i).lastIndexOf("]")<0)return!1}if(/\||::|\[\s*[\w$*=^|~-]+(?:(?:"[\w$*=^|~\s'-]+"|'[\w$*=^|~\s"-]+')?(?:\s+[\w$*=^|~-]+)+|"[^"\]]{1,255}|'[^'\]]{1,255})\s*\]/.test(n))return!1;if(n.includes(":")){let i;if(e.REG_LOGICAL_KEY.test(n)){if(e.REG_LOGICAL_EMPTY.test(n))return!1;const{complex:r,descendant:s}=t;r&&s?i=e.REG_LOGICAL_COMPLEX_A:r?i=e.REG_LOGICAL_COMPLEX_B:i=e.REG_LOGICAL_COMPOUND}else i=e.REG_CHILD_INDEXED;if(i.test(n))return!1}return!0};0&&(module.exports={filterSelector,generateCSS,parseAstName,parseSelector,preprocess,sortAST,unescapeSelector,walkAST});
//# sourceMappingURL=parser.js.map
