var S=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var _=(s,e)=>{for(var r in e)S(s,r,{get:e[r],enumerable:!0})},b=(s,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of y(e))!$.call(s,n)&&n!==r&&S(s,n,{get:()=>e[n],enumerable:!(o=O(e,n))||o.enumerable});return s};var C=s=>b(S({},"__esModule",{value:!0}),s);var D={};_(D,{findAST:()=>E.find,generateCSS:()=>E.generate,parseAstName:()=>I,parseSelector:()=>u,preprocess:()=>T,sortAST:()=>A,unescapeSelector:()=>F,walkAST:()=>L});module.exports=C(D);var h=require("css-tree"),w=require("./utility.js"),t=require("./constant.js"),E=require("css-tree");const m=/(?<=:(?:dir|has|host(?:-context)?|is|lang|not|nth-(?:last-)?(?:child|of-type)|where)\()\s+\)/g,x=/^part|slotted$/,g="\uFFFD",F=(s="")=>{if(typeof s=="string"&&s.indexOf("\\",0)>=0){const e=s.split("\\"),r=e.length;for(let o=1;o<r;o++){let n=e[o];if(n===""&&o===r-1)n=g;else{const p=/^([\da-f]{1,6}\s?)/i.exec(n);if(p){const[,l]=p;let a;try{const i=parseInt("D800",t.HEX),f=parseInt("DFFF",t.HEX),d=parseInt(l,t.HEX);d===0||d>=i&&d<=f?a=g:a=String.fromCodePoint(d)}catch{a=g}let c="";n.length>l.length&&(c=n.substring(l.length)),n=`${a}${c}`}else/^[\n\r\f]/.test(n)&&(n="\\"+n)}e[o]=n}s=e.join("")}return s},T=(...s)=>{if(!s.length)throw new TypeError("1 argument required, but only 0 present.");let[e]=s;if(typeof e=="string"){let r=0;for(;r>=0&&(r=e.indexOf("#",r),!(r<0));){const o=e.substring(0,r+1);let n=e.substring(r+1);if(/^\d$/.test(n.substring(0,1)))throw new DOMException(`Invalid selector ${e}`,t.SYNTAX_ERR);const p=n.codePointAt(0);if(p===t.HYPHEN){if(/^\d$/.test(n.substring(1,2)))throw new DOMException(`Invalid selector ${e}`,t.SYNTAX_ERR)}else if(p>t.BIT_FFFF){const l=`\\${p.toString(t.HEX)} `;n.length===t.DUO?n=l:n=`${l}${n.substring(t.DUO)}`}e=`${o}${n}`,r++}e=e.replace(/\f|\r\n?/g,`
`).replace(/[\0\uD800-\uDFFF]|\\$/g,g)}else if(e==null)e=(0,w.getType)(e).toLowerCase();else if(Array.isArray(e))e=e.join(",");else if(Object.prototype.hasOwnProperty.call(e,"toString"))e=e.toString();else throw new DOMException(`Invalid selector ${e}`,t.SYNTAX_ERR);return e},u=s=>{if(s=T(s),/^$|^\s*>|,\s*$/.test(s))throw new DOMException(`Invalid selector ${s}`,t.SYNTAX_ERR);let e;try{const r=(0,h.parse)(s,{context:"selectorList",parseCustomProperty:!0});e=(0,h.toPlainObject)(r)}catch(r){const{message:o}=r;if(/^(?:"\]"|Attribute selector [()\s,=~^$*|]+) is expected$/.test(o)&&!s.endsWith("]")){const n=s.lastIndexOf("["),p=s.substring(n);p.includes('"')?p.match(/"/g).length%2?e=u(`${s}"]`):e=u(`${s}]`):e=u(`${s}]`)}else if(o==='")" is expected')if(m.test(s))e=u(`${s.replaceAll(m,")")}`);else if(!s.endsWith(")"))e=u(`${s})`);else throw new DOMException(o,t.SYNTAX_ERR);else throw new DOMException(o,t.SYNTAX_ERR)}return e},L=(s={})=>{const e=new Set,r=new Map;return(0,h.walk)(s,{enter:n=>{switch(n.type){case t.SELECTOR:{e.add(n.children);break}case t.PS_CLASS_SELECTOR:{t.KEY_LOGICAL.includes(n.name)&&(r.set("hasNestedSelector",!0),r.set("hasLogicalPseudoFunc",!0),n.name==="has"&&r.set("hasHasPseudoFunc",!0));break}case t.PS_ELEMENT_SELECTOR:{x.test(n.name)&&r.set("hasNestedSelector",!0);break}case t.NTH:{n.selector&&(r.set("hasNestedSelector",!0),r.set("hasNthChildOfSelector",!0));break}default:}}}),r.get("hasNestedSelector")&&(0,h.findAll)(s,(n,p,l)=>{if(l){if(n.type===t.PS_CLASS_SELECTOR&&t.KEY_LOGICAL.includes(n.name)){const a=l.filter(c=>{const{name:i,type:f}=c;return f===t.PS_CLASS_SELECTOR&&t.KEY_LOGICAL.includes(i)});for(const{children:c}of a)for(const{children:i}of c)for(const{children:f}of i)e.has(f)&&e.delete(f)}else if(n.type===t.PS_ELEMENT_SELECTOR&&x.test(n.name)){const a=l.filter(c=>{const{name:i,type:f}=c;return f===t.PS_ELEMENT_SELECTOR&&x.test(i)});for(const{children:c}of a)for(const{children:i}of c)e.has(i)&&e.delete(i)}else if(n.type===t.NTH&&n.selector){const a=l.filter(c=>{const{selector:i,type:f}=c;return f===t.NTH&&i});for(const{selector:c}of a){const{children:i}=c;for(const{children:f}of i)e.has(f)&&e.delete(f)}}}}),{branches:[...e],info:Object.fromEntries(r)}},A=s=>{const e=[...s];if(e.length>1){const r=new Map([[t.PS_ELEMENT_SELECTOR,t.BIT_01],[t.ID_SELECTOR,t.BIT_02],[t.CLASS_SELECTOR,t.BIT_04],[t.TYPE_SELECTOR,t.BIT_08],[t.ATTR_SELECTOR,t.BIT_16],[t.PS_CLASS_SELECTOR,t.BIT_32]]);e.sort((o,n)=>{const{type:p}=o,{type:l}=n,a=r.get(p),c=r.get(l);let i;return a===c?i=0:a>c?i=1:i=-1,i})}return e},I=s=>{let e,r;if(s&&typeof s=="string")s.indexOf("|")>-1?[e,r]=s.split("|"):(e="*",r=s);else throw new DOMException(`Invalid selector ${s}`,t.SYNTAX_ERR);return{prefix:e,localName:r}};0&&(module.exports={findAST,generateCSS,parseAstName,parseSelector,preprocess,sortAST,unescapeSelector,walkAST});
//# sourceMappingURL=parser.js.map
