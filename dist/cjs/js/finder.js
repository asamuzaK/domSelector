var H=Object.create;var P=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var V=(x,a)=>{for(var e in a)P(x,e,{get:a[e],enumerable:!0})},I=(x,a,e,r)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of B(a))!q.call(x,i)&&i!==e&&P(x,i,{get:()=>a[i],enumerable:!(r=j(a,i))||r.enumerable});return x};var z=(x,a,e)=>(e=x!=null?H(G(x)):{},I(a||!x||!x.__esModule?P(e,"default",{value:x,enumerable:!0}):e,x)),X=x=>I(P({},"__esModule",{value:!0}),x);var K={};V(K,{Finder:()=>Y});module.exports=X(K);var W=z(require("is-potential-custom-element-name"),1),F=z(require("nwsapi"),1),A=require("./dom-util.js"),M=require("./matcher.js"),S=require("./parser.js"),f=require("./constant.js");const C="next",O="prev",L="all",$="first",R="lineal",D="self",U=f.SHOW_DOCUMENT|f.SHOW_DOCUMENT_FRAGMENT|f.SHOW_ELEMENT;class Y{#l;#r;#t;#f;#i;#n;#e;#c;#w;#o;#m;#s;#h;#u;#d;#b;#a;#p;constructor(a){this.#p=a,this.#i=a.document,this.#r=new WeakMap,this.#m=new WeakMap,this.#o=(0,F.default)({document:a.document,DOMException:a.DOMException}),this.#o.configure({LOGERRORS:!1})}_onError(a){if(!this.#w)if(a instanceof DOMException||a instanceof this.#p.DOMException)if(a.name===f.NOT_SUPPORTED_ERR)this.#a&&console.warn(a.message);else throw new this.#p.DOMException(a.message,a.name);else throw a}_setup(a,e,r={},i=!1){const{noexcept:s,warn:n}=r;return this.#w=!!s,this.#a=!!n,this.#e=e,[this.#t,this.#s]=(0,A.resolveContent)(e),this.#h=(0,A.isInShadowTree)(e),i||this._correspond(a),e}_correspond(a){const e=[];let r,i=this.#t&&this.#r.get(this.#t);if(this.#f=!1,this.#u=!1,i&&i.has(`${a}`)){const s=i.get(`${a}`);r=s.ast,this.#f=s.descendant,this.#u=s.sibling}if(r){const s=r.length;for(let n=0;n<s;n++)r[n].dir=null,r[n].filtered=!1,r[n].find=!1,e[n]=[]}else{let s;try{s=(0,S.parseSelector)(a)}catch(t){this._onError(t)}const n=(0,S.walkAST)(s);r=[];let o=!1,b=!1,c=0;for(const[...t]of n){const l=[];let h=t.shift();if(h&&h.type!==f.COMBINATOR){const d=new Set;for(;h;){if(h.type===f.COMBINATOR){const[w]=t;if(w.type===f.COMBINATOR){const k=`Invalid selector ${a}`;throw new DOMException(k,f.SYNTAX_ERR)}const m=(0,S.unescapeSelector)(h.name);m==="~"?b=!0:/^[\s>]$/.test(m)&&(o=!0),l.push({combo:h,leaves:(0,S.sortAST)(d)}),d.clear()}else if(h){let{name:w}=h;w&&typeof w=="string"&&(w=(0,S.unescapeSelector)(w),/[|:]/.test(w)&&(h.namespace=!0)),d.add(h)}if(t.length)h=t.shift();else{l.push({combo:null,leaves:(0,S.sortAST)(d)}),d.clear();break}}}r.push({branch:l,dir:null,filtered:!1,find:!1}),e[c]=[],c++}this.#t&&(i||(i=new Map),i.set(`${a}`,{ast:r,descendant:o,sibling:b}),this.#r.set(this.#t,i)),this.#f=o,this.#u=b}return this.#l=r,this.#c=e,[r,e]}_prepareTreeWalkers(a){return this.#b=this.#i.createTreeWalker(this.#s,U),this.#n=this.#i.createTreeWalker(a,U),this.#d=!1,[this.#b,this.#n]}_traverse(a={},e=this.#b){let r,i=e.currentNode;if(a.nodeType===f.ELEMENT_NODE&&i===a)r=i;else{if(i!==e.root)for(;i&&!(i===e.root||a.nodeType===f.ELEMENT_NODE&&i===a);)i=e.parentNode();if(a.nodeType===f.ELEMENT_NODE)for(;i;){if(i===a){r=i;break}i=e.nextNode()}else r=i}return r??null}_collectNthChild(a,e,r){const{a:i,b:s,reverse:n,selector:o}=a,{parentNode:b}=e,c=new Set;let t;if(o&&(this.#r.has(o)?t=this.#r.get(o):(t=(0,S.walkAST)(o),this.#r.set(o,t))),b){const l=this.#i.createTreeWalker(b,U);let h=0,d=l.firstChild();for(;d;)h++,d=l.nextSibling();d=this._traverse(b,l);const w=new Set;if(t)for(d=this._traverse(b,l),d=l.firstChild();d;){let m;for(const k of t)if(m=this._matchLeaves(k,d,r),!m)break;m&&w.add(d),d=l.nextSibling()}if(i===0){if(s>0&&s<=h){if(w.size){let m=0;for(d=this._traverse(b,l),n?d=l.lastChild():d=l.firstChild();d;){if(w.has(d)){if(m===s-1){c.add(d);break}m++}n?d=l.previousSibling():d=l.nextSibling()}}else if(!o){let m=0;for(d=this._traverse(b,l),n?d=l.lastChild():d=l.firstChild();d;){if(m===s-1){c.add(d);break}n?d=l.previousSibling():d=l.nextSibling(),m++}}}}else{let m=s-1;if(i>0)for(;m<0;)m+=i;if(m>=0&&m<h){let k=0,_=i>0?0:s-1;for(d=this._traverse(b,l),n?d=l.lastChild():d=l.firstChild();d&&(d&&m>=0&&m<h);)w.size?w.has(d)&&(_===m&&(c.add(d),m+=i),i>0?_++:_--):k===m&&(o||c.add(d),m+=i),n?d=l.previousSibling():d=l.nextSibling(),k++}}if(n&&c.size>1){const m=[...c];return new Set(m.reverse())}}else if(e===this.#s&&i+s===1)if(t){let l;for(const h of t)if(l=this._matchLeaves(h,e,r),l)break;l&&c.add(e)}else c.add(e);return c}_collectNthOfType(a,e){const{a:r,b:i,reverse:s}=a,{localName:n,parentNode:o,prefix:b}=e,c=new Set;if(o){const t=this.#i.createTreeWalker(o,U);let l=0,h=t.firstChild();for(;h;)l++,h=t.nextSibling();if(r===0){if(i>0&&i<=l){let d=0;for(h=this._traverse(o,t),s?h=t.lastChild():h=t.firstChild();h;){const{localName:w,prefix:m}=h;if(w===n&&m===b){if(d===i-1){c.add(h);break}d++}s?h=t.previousSibling():h=t.nextSibling()}}}else{let d=i-1;if(r>0)for(;d<0;)d+=r;if(d>=0&&d<l){let w=r>0?0:i-1;for(h=this._traverse(o,t),s?h=t.lastChild():h=t.firstChild();h;){const{localName:m,prefix:k}=h;if(m===n&&k===b){if(w===d&&(c.add(h),d+=r),d<0||d>=l)break;r>0?w++:w--}s?h=t.previousSibling():h=t.nextSibling()}}}if(s&&c.size>1){const d=[...c];return new Set(d.reverse())}}else e===this.#s&&r+i===1&&c.add(e);return c}_matchAnPlusB(a,e,r,i){const{nth:{a:s,b:n,name:o},selector:b}=a,c=(0,S.unescapeSelector)(o),t=new Map;if(c?(c==="even"?(t.set("a",2),t.set("b",0)):c==="odd"&&(t.set("a",2),t.set("b",1)),r.indexOf("last")>-1&&t.set("reverse",!0)):(typeof s=="string"&&/-?\d+/.test(s)?t.set("a",s*1):t.set("a",0),typeof n=="string"&&/-?\d+/.test(n)?t.set("b",n*1):t.set("b",0),r.indexOf("last")>-1&&t.set("reverse",!0)),/^nth-(?:last-)?child$/.test(r)){b&&t.set("selector",b);const l=Object.fromEntries(t);return this._collectNthChild(l,e,i)}else if(/^nth-(?:last-)?of-type$/.test(r)){const l=Object.fromEntries(t);return this._collectNthOfType(l,e)}return new Set}_matchDirectionPseudoClass(a,e){const r=(0,S.unescapeSelector)(a.name),i=(0,A.getDirectionality)(e);let s;return r===i&&(s=e),s??null}_matchLanguagePseudoClass(a,e){const r=(0,S.unescapeSelector)(a.name);let i;if(r==="*")if(e.hasAttribute("lang"))e.getAttribute("lang")&&(i=e);else{let s=e.parentNode;for(;s&&s.nodeType===f.ELEMENT_NODE;){if(s.hasAttribute("lang")){s.getAttribute("lang")&&(i=e);break}s=s.parentNode}}else if(r){const s=`(?:-${f.ALPHA_NUM})*`;if(new RegExp(`^(?:\\*-)?${f.ALPHA_NUM}${s}$`,"i").test(r)){let o;if(r.indexOf("-")>-1){const[b,c,...t]=r.split("-");let l;b==="*"?l=`${f.ALPHA_NUM}${s}`:l=`${b}${s}`;const h=`-${c}${s}`,d=t.length;let w="";if(d)for(let m=0;m<d;m++)w+=`-${t[m]}${s}`;o=new RegExp(`^${l}${h}${w}$`,"i")}else o=new RegExp(`^${r}${s}$`,"i");if(e.hasAttribute("lang"))o.test(e.getAttribute("lang"))&&(i=e);else{let b=e.parentNode;for(;b&&b.nodeType===f.ELEMENT_NODE;){if(b.hasAttribute("lang")){const c=b.getAttribute("lang");o.test(c)&&(i=e);break}b=b.parentNode}}}}return i??null}_matchHasPseudoFunc(a,e,r={}){let i;if(Array.isArray(a)&&a.length){const[s]=a,{type:n}=s;let o;n===f.COMBINATOR?o=a.shift():o={name:" ",type:f.COMBINATOR};const b=[];for(;a.length;){const[l]=a,{type:h}=l;if(h===f.COMBINATOR)break;b.push(a.shift())}const c={combo:o,leaves:b};r.dir=C;const t=this._matchCombinator(c,e,r);if(t.size)if(a.length){for(const l of t)if(i=this._matchHasPseudoFunc(Object.assign([],a),l,r),i)break}else i=!0}return!!i}_matchLogicalPseudoFunc(a,e,r={}){const{astName:i="",branches:s=[],selector:n="",twigBranches:o=[]}=a;let b;if(i==="has")if(n.includes(":has("))b=null;else{let c;for(const t of s)if(c=this._matchHasPseudoFunc(Object.assign([],t),e,r),c)break;c&&(b=e)}else{const c=/^(?:is|where)$/.test(i);r.forgive=c;const t=o.length;let l;for(let h=0;h<t;h++){const d=o[h],w=d.length-1,{leaves:m}=d[w];if(l=this._matchLeaves(m,e,r),l&&w>0){let k=new Set([e]);for(let _=w-1;_>=0;_--){const y=d[_],u=[];r.dir=O;for(const p of k){const g=this._matchCombinator(y,p,r);g.size&&u.push(...g)}if(u.length)_===0?l=!0:k=new Set(u);else{l=!1;break}}}if(l)break}i==="not"?l||(b=e):l&&(b=e)}return b??null}_matchPseudoClassSelector(a,e,r={}){const{children:i}=a,{localName:s,parentNode:n}=e,{forgive:o,warn:b=this.#a}=r,c=(0,S.unescapeSelector)(a.name),t=new Set;if(f.REG_LOGICAL_PSEUDO.test(c)){let l;if(this.#r.has(a))l=this.#r.get(a);else{const d=(0,S.walkAST)(a),w=[],m=[];for(const[...k]of d){for(const p of k){const g=(0,S.generateCSS)(p);w.push(g)}const _=[],y=new Set;let u=k.shift();for(;u;)if(u.type===f.COMBINATOR?(_.push({combo:u,leaves:[...y]}),y.clear()):u&&y.add(u),k.length)u=k.shift();else{_.push({combo:null,leaves:[...y]}),y.clear();break}m.push(_)}l={astName:c,branches:d,twigBranches:m,selector:w.join(",")},this.#r.set(a,l)}const h=this._matchLogicalPseudoFunc(l,e,r);h&&t.add(h)}else if(Array.isArray(i)){const[l]=i;if(/^nth-(?:last-)?(?:child|of-type)$/.test(c))return this._matchAnPlusB(l,e,c,r);if(c==="dir"){const h=this._matchDirectionPseudoClass(l,e);h&&t.add(h)}else if(c==="lang"){const h=this._matchLanguagePseudoClass(l,e);h&&t.add(h)}else switch(c){case"current":case"nth-col":case"nth-last-col":{if(b){const h=`Unsupported pseudo-class :${c}()`;throw new DOMException(h,f.NOT_SUPPORTED_ERR)}break}case"host":case"host-context":break;default:if(!o){const h=`Unknown pseudo-class :${c}()`;throw new DOMException(h,f.SYNTAX_ERR)}}}else{const l=/^a(?:rea)?$/,h=/^(?:(?:fieldse|inpu|selec)t|button|opt(?:group|ion)|textarea)$/,d=/^(?:(?:inpu|selec)t|button|form|textarea)$/,w=/^d(?:etails|ialog)$/,m=/^(?:checkbox|radio)$/,k=/^(?:date(?:time-local)?|month|time|week)$/,_=/(?:(?:rang|tim)e|date(?:time-local)?|month|number|week)$/,y=/^(?:(?:emai|te|ur)l|number|password|search|text)$/;switch(c){case"any-link":case"link":{l.test(s)&&e.hasAttribute("href")&&t.add(e);break}case"local-link":{if(l.test(s)&&e.hasAttribute("href")){const{href:u,origin:p,pathname:g}=new URL(this.#t.URL),N=new URL(e.getAttribute("href"),u);N.origin===p&&N.pathname===g&&t.add(e)}break}case"visited":break;case"target":{const{hash:u}=new URL(this.#t.URL);e.id&&u===`#${e.id}`&&this.#t.contains(e)&&t.add(e);break}case"target-within":{const{hash:u}=new URL(this.#t.URL);if(u){const p=u.replace(/^#/,"");let g=this.#t.getElementById(p);for(;g;){if(g===e){t.add(e);break}g=g.parentNode}}break}case"scope":{this.#e.nodeType===f.ELEMENT_NODE?!this.#h&&e===this.#e&&t.add(e):e===this.#t.documentElement&&t.add(e);break}case"focus":{if(e===this.#t.activeElement){let u=!0,p=e;for(;p;){if(p.hasAttribute("hidden")){u=!1;break}else if(p.hasAttribute("style")){const{display:g,visibility:N}=p.style;if(u=!(g==="none"||N==="hidden"),!u)break}if(p.parentNode&&p.parentNode.nodeType===f.ELEMENT_NODE)p=p.parentNode;else break}u&&t.add(e)}break}case"focus-within":{let u,p=this.#t.activeElement;for(;p;){if(p===e){u=!0;break}p=p.parentNode}if(u){let g=!0,N=e;for(;N;){if(N.hasAttribute("hidden")){g=!1;break}else if(N.hasAttribute("style")){const{display:E,visibility:T}=N.style;if(g=!(E==="none"||T==="hidden"),!g)break}if(N.parentNode&&N.parentNode.nodeType===f.ELEMENT_NODE)N=N.parentNode;else break}g&&t.add(e)}break}case"open":{w.test(s)&&e.hasAttribute("open")&&t.add(e);break}case"closed":{w.test(s)&&!e.hasAttribute("open")&&t.add(e);break}case"disabled":{if(h.test(s)||(0,W.default)(s))if(e.disabled||e.hasAttribute("disabled"))t.add(e);else{let u=n;for(;u&&u.localName!=="fieldset";)u=u.parentNode;u&&n.localName!=="legend"&&u.hasAttribute("disabled")&&t.add(e)}break}case"enabled":{(h.test(s)||(0,W.default)(s))&&!(e.disabled&&e.hasAttribute("disabled"))&&t.add(e);break}case"read-only":{switch(s){case"textarea":{(e.readonly||e.hasAttribute("readonly")||e.disabled||e.hasAttribute("disabled"))&&t.add(e);break}case"input":{(!e.type||k.test(e.type)||y.test(e.type))&&(e.readonly||e.hasAttribute("readonly")||e.disabled||e.hasAttribute("disabled"))&&t.add(e);break}default:(0,A.isContentEditable)(e)||t.add(e)}break}case"read-write":{switch(s){case"textarea":{e.readonly||e.hasAttribute("readonly")||e.disabled||e.hasAttribute("disabled")||t.add(e);break}case"input":{(!e.type||k.test(e.type)||y.test(e.type))&&!(e.readonly||e.hasAttribute("readonly")||e.disabled||e.hasAttribute("disabled"))&&t.add(e);break}default:(0,A.isContentEditable)(e)&&t.add(e)}break}case"placeholder-shown":{let u;s==="textarea"?u=e:s==="input"&&(e.hasAttribute("type")?y.test(e.getAttribute("type"))&&(u=e):u=e),u&&e.value===""&&e.hasAttribute("placeholder")&&e.getAttribute("placeholder").trim().length&&t.add(e);break}case"checked":{(e.checked&&s==="input"&&e.hasAttribute("type")&&m.test(e.getAttribute("type"))||e.selected&&s==="option")&&t.add(e);break}case"indeterminate":{if(e.indeterminate&&s==="input"&&e.type==="checkbox"||s==="progress"&&!e.hasAttribute("value"))t.add(e);else if(s==="input"&&e.type==="radio"&&!e.hasAttribute("checked")){const u=e.name;let p=e.parentNode;for(;p&&p.localName!=="form";)p=p.parentNode;p||(p=this.#t.documentElement);let g;const N=p.getElementsByTagName("input"),E=N.length;if(E)for(let T=0;T<E;T++){const v=N[T];if(v.getAttribute("type")==="radio"&&(u?v.getAttribute("name")===u&&(g=!!v.checked):v.hasAttribute("name")||(g=!!v.checked),g))break}g||t.add(e)}break}case"default":{const u=/^(?:button|reset)$/,p=/^(?:image|submit)$/;if(s==="button"&&!(e.hasAttribute("type")&&u.test(e.getAttribute("type")))||s==="input"&&e.hasAttribute("type")&&p.test(e.getAttribute("type"))){let g=e.parentNode;for(;g&&g.localName!=="form";)g=g.parentNode;if(g){const N=this.#i.createTreeWalker(g,f.SHOW_ELEMENT);let E=N.firstChild();for(;E;){const T=E.localName;let v;if(T==="button"?v=!(E.hasAttribute("type")&&u.test(E.getAttribute("type"))):T==="input"&&(v=E.hasAttribute("type")&&p.test(E.getAttribute("type"))),v){E===e&&t.add(e);break}E=N.nextNode()}}}else if(s==="input"&&e.hasAttribute("type")&&m.test(e.getAttribute("type"))&&(e.checked||e.hasAttribute("checked")))t.add(e);else if(s==="option"){let g=!1,N=n;for(;N&&N.localName!=="datalist";){if(N.localName==="select"){(N.multiple||N.hasAttribute("multiple"))&&(g=!0);break}N=N.parentNode}if(g)(e.selected||e.hasAttribute("selected"))&&t.add(e);else{const E=new Set,T=this.#i.createTreeWalker(n,f.SHOW_ELEMENT);let v=T.firstChild();for(;v;){if(v.selected||v.hasAttribute("selected")){E.add(v);break}v=T.nextSibling()}E.size&&E.has(e)&&t.add(e)}}break}case"valid":{if(d.test(s))e.checkValidity()&&t.add(e);else if(s==="fieldset"){let u;const p=this.#i.createTreeWalker(e,f.SHOW_ELEMENT);let g=p.firstChild();for(;g&&!(d.test(g.localName)&&(u=g.checkValidity(),!u));)g=p.nextNode();u&&t.add(e)}break}case"invalid":{if(d.test(s))e.checkValidity()||t.add(e);else if(s==="fieldset"){let u;const p=this.#i.createTreeWalker(e,f.SHOW_ELEMENT);let g=p.firstChild();for(;g&&!(d.test(g.localName)&&(u=g.checkValidity(),!u));)g=p.nextNode();u||t.add(e)}break}case"in-range":{s==="input"&&!(e.readonly||e.hasAttribute("readonly"))&&!(e.disabled||e.hasAttribute("disabled"))&&e.hasAttribute("type")&&_.test(e.getAttribute("type"))&&!(e.validity.rangeUnderflow||e.validity.rangeOverflow)&&(e.hasAttribute("min")||e.hasAttribute("max")||e.getAttribute("type")==="range")&&t.add(e);break}case"out-of-range":{s==="input"&&!(e.readonly||e.hasAttribute("readonly"))&&!(e.disabled||e.hasAttribute("disabled"))&&e.hasAttribute("type")&&_.test(e.getAttribute("type"))&&(e.validity.rangeUnderflow||e.validity.rangeOverflow)&&t.add(e);break}case"required":{let u;if(/^(?:select|textarea)$/.test(s))u=e;else if(s==="input")if(e.hasAttribute("type")){const p=e.getAttribute("type");(p==="file"||m.test(p)||k.test(p)||y.test(p))&&(u=e)}else u=e;u&&(e.required||e.hasAttribute("required"))&&t.add(e);break}case"optional":{let u;if(/^(?:select|textarea)$/.test(s))u=e;else if(s==="input")if(e.hasAttribute("type")){const p=e.getAttribute("type");(p==="file"||m.test(p)||k.test(p)||y.test(p))&&(u=e)}else u=e;u&&!(e.required||e.hasAttribute("required"))&&t.add(e);break}case"root":{e===this.#t.documentElement&&t.add(e);break}case"empty":{if(e.hasChildNodes()){let u;const p=this.#i.createTreeWalker(e,f.SHOW_ALL);let g=p.firstChild();for(;g&&(u=g.nodeType!==f.ELEMENT_NODE&&g.nodeType!==f.TEXT_NODE,!!u);)g=p.nextSibling();u&&t.add(e)}else t.add(e);break}case"first-child":{(n&&e===n.firstElementChild||e===this.#s)&&t.add(e);break}case"last-child":{(n&&e===n.lastElementChild||e===this.#s)&&t.add(e);break}case"only-child":{(n&&e===n.firstElementChild&&e===n.lastElementChild||e===this.#s)&&t.add(e);break}case"first-of-type":{if(n){const[u]=this._collectNthOfType({a:0,b:1},e);u&&t.add(u)}else e===this.#s&&t.add(e);break}case"last-of-type":{if(n){const[u]=this._collectNthOfType({a:0,b:1,reverse:!0},e);u&&t.add(u)}else e===this.#s&&t.add(e);break}case"only-of-type":{if(n){const[u]=this._collectNthOfType({a:0,b:1},e);if(u===e){const[p]=this._collectNthOfType({a:0,b:1,reverse:!0},e);p===e&&t.add(e)}}else e===this.#s&&t.add(e);break}case"host":case"host-context":break;case"after":case"before":case"first-letter":case"first-line":{if(b){const u=`Unsupported pseudo-element ::${c}`;throw new DOMException(u,f.NOT_SUPPORTED_ERR)}break}case"active":case"autofill":case"blank":case"buffering":case"current":case"defined":case"focus-visible":case"fullscreen":case"future":case"hover":case"modal":case"muted":case"past":case"paused":case"picture-in-picture":case"playing":case"seeking":case"stalled":case"user-invalid":case"user-valid":case"volume-locked":case"-webkit-autofill":{if(b){const u=`Unsupported pseudo-class :${c}`;throw new DOMException(u,f.NOT_SUPPORTED_ERR)}break}default:if(c.startsWith("-webkit-")){if(b){const u=`Unsupported pseudo-class :${c}`;throw new DOMException(u,f.NOT_SUPPORTED_ERR)}}else if(!o){const u=`Unknown pseudo-class :${c}`;throw new DOMException(u,f.SYNTAX_ERR)}}}return t}_matchShadowHostPseudoClass(a,e){const{children:r}=a,i=(0,S.unescapeSelector)(a.name);let s;if(Array.isArray(r)){const[n]=(0,S.walkAST)(r[0]),[...o]=n,{host:b}=e;if(i==="host"){let c;for(const t of o){const{type:l}=t;if(l===f.COMBINATOR){const d=`Invalid selector ${(0,S.generateCSS)(a)}`;throw new DOMException(d,f.SYNTAX_ERR)}if(c=this._matchSelector(t,b).has(b),!c)break}c&&(s=e)}else if(i==="host-context"){let c,t=b;for(;t;){for(const l of o){const{type:h}=l;if(h===f.COMBINATOR){const w=`Invalid selector ${(0,S.generateCSS)(a)}`;throw new DOMException(w,f.SYNTAX_ERR)}if(c=this._matchSelector(l,t).has(t),!c)break}if(c)break;t=t.parentNode}c&&(s=e)}}else if(i==="host")s=e;else{const n=`Invalid selector :${i}`;throw new DOMException(n,f.SYNTAX_ERR)}return s??null}_matchSelector(a,e,r){const{type:i}=a,s=(0,S.unescapeSelector)(a.name),n=new Set;if(e.nodeType===f.ELEMENT_NODE)switch(i){case f.SELECTOR_PSEUDO_ELEMENT:{(0,M.matchPseudoElementSelector)(s,r);break}case f.SELECTOR_ID:{e.id===s&&n.add(e);break}case f.SELECTOR_CLASS:{e.classList.contains(s)&&n.add(e);break}case f.SELECTOR_PSEUDO_CLASS:return this._matchPseudoClassSelector(a,e,r);default:{const o=(0,M.matchSelector)(a,e,r);o&&n.add(o)}}else if(this.#h&&i===f.SELECTOR_PSEUDO_CLASS&&e.nodeType===f.DOCUMENT_FRAGMENT_NODE){if(s!=="has"&&f.REG_LOGICAL_PSEUDO.test(s))return this._matchPseudoClassSelector(a,e,r);if(f.REG_SHADOW_HOST.test(s)){const o=this._matchShadowHostPseudoClass(a,e,r);o&&n.add(o)}}return n}_matchLeaves(a,e,r){const{attributes:i,localName:s,nodeType:n}=e;let o,b=this.#m.get(a);if(b&&b.has(e)){const{attr:c,matched:t}=b.get(e);i?.length===c&&(o=t)}if(typeof o!="boolean"){const c=/^(?:(?:fieldse|inpu|selec)t|button|form|textarea)$/;let t;n===f.ELEMENT_NODE&&c.test(s)?t=!1:t=!0;for(const l of a){const{name:h,type:d}=l,w=(0,S.unescapeSelector)(h);if(d===f.SELECTOR_PSEUDO_CLASS&&w==="dir"&&(t=!1),o=this._matchSelector(l,e,r).has(e),!o)break}t&&(b||(b=new WeakMap),b.set(e,{attr:i?.length,matched:o}),this.#m.set(a,b))}return!!o}_matchHTMLCollection(a,e={}){const{compound:r,filterLeaves:i}=e,s=new Set,n=a.length;if(n)if(r)for(let o=0;o<n;o++){const b=a[o];this._matchLeaves(i,b,e)&&s.add(b)}else{const o=[].slice.call(a);return new Set(o)}return s}_findDescendantNodes(a,e,r){const[i,...s]=a,{type:n}=i,o=(0,S.unescapeSelector)(i.name),b=s.length>0;let c=new Set,t=!1;if(this.#h)t=!0;else switch(n){case f.SELECTOR_PSEUDO_ELEMENT:{(0,M.matchPseudoElementSelector)(o,r);break}case f.SELECTOR_ID:{if(this.#s.nodeType===f.ELEMENT_NODE)t=!0;else{const l=this.#s.getElementById(o);l&&l!==e&&e.contains(l)&&(b?this._matchLeaves(s,l,r)&&c.add(l):c.add(l))}break}case f.SELECTOR_CLASS:{const l=e.getElementsByClassName(o);c=this._matchHTMLCollection(l,{compound:b,filterLeaves:s});break}case f.SELECTOR_TYPE:{if(this.#t.contentType==="text/html"&&!/[*|]/.test(o)){const l=e.getElementsByTagName(o);c=this._matchHTMLCollection(l,{compound:b,filterLeaves:s})}else t=!0;break}default:t=!0}return{nodes:c,pending:t}}_matchCombinator(a,e,r={}){const{combo:i,leaves:s}=a,{name:n}=i,{dir:o}=r,b=new Set;if(o===C)switch(n){case"+":{const c=e.nextElementSibling;c&&this._matchLeaves(s,c,r)&&b.add(c);break}case"~":{const{parentNode:c}=e;if(c){const t=this.#i.createTreeWalker(c,f.SHOW_ELEMENT);let l=this._traverse(e,t);for(l===e&&(l=t.nextSibling());l;)this._matchLeaves(s,l,r)&&b.add(l),l=t.nextSibling()}break}case">":{const c=this.#i.createTreeWalker(e,f.SHOW_ELEMENT);let t=c.firstChild();for(;t;)this._matchLeaves(s,t,r)&&b.add(t),t=c.nextSibling();break}case" ":default:{const{nodes:c,pending:t}=this._findDescendantNodes(s,e);if(c.size)return c;if(t){const l=this.#i.createTreeWalker(e,f.SHOW_ELEMENT);let h=l.nextNode();for(;h;)this._matchLeaves(s,h,r)&&b.add(h),h=l.nextNode()}}}else switch(n){case"+":{const c=e.previousElementSibling;c&&this._matchLeaves(s,c,r)&&b.add(c);break}case"~":{const c=this.#i.createTreeWalker(e.parentNode,f.SHOW_ELEMENT);let t=c.firstChild();for(;t&&t!==e;)this._matchLeaves(s,t,r)&&b.add(t),t=c.nextSibling();break}case">":{const c=e.parentNode;c&&this._matchLeaves(s,c,r)&&b.add(c);break}case" ":default:{const c=[];let t=e.parentNode;for(;t;)this._matchLeaves(s,t,r)&&c.push(t),t=t.parentNode;if(c.length)return new Set(c.reverse())}}return b}_findNode(a,e={}){const{node:r}=e;let i,s=this._traverse(r,this.#n);if(s)for(s.nodeType!==f.ELEMENT_NODE?s=this.#n.nextNode():s===r&&s!==this.#s&&(s=this.#n.nextNode());s;){let n;if(this.#e.nodeType===f.ELEMENT_NODE?s===this.#e?n=!0:n=this.#e.contains(s):n=!0,n&&this._matchLeaves(a,s,{warn:this.#a})){i=s;break}s=this.#n.nextNode()}return i??null}_matchSelf(a){const e=[];let r=!1;return this._matchLeaves(a,this.#e,{warn:this.#a})&&(e.push(this.#e),r=!0),[e,r]}_findLineal(a,e={}){const{complex:r}=e,i=[];let s=!1,n=this._matchLeaves(a,this.#e,{warn:this.#a});if(n&&(i.push(this.#e),s=!0),!n||r){let o=this.#e.parentNode;for(;o&&(n=this._matchLeaves(a,o,{warn:this.#a}),n&&(i.push(o),s=!0),o.parentNode);)o=o.parentNode}return[i,s]}_findFirst(a){const e=[];let r=!1;const i=this._findNode(a,{node:this.#e});return i&&(e.push(i),r=!0),[e,r]}_findFromHTMLCollection(a,e={}){const{complex:r,compound:i,filterLeaves:s}=e;let n=[],o=!1,b=!1;const c=a.length;if(c)if(this.#e.nodeType===f.ELEMENT_NODE)for(let t=0;t<c;t++){const l=a[t];(l===this.#e||(0,A.isInclusive)(l,this.#e))&&(i?this._matchLeaves(s,l,{warn:this.#a})&&(n.push(l),o=!0):(n.push(l),o=!0))}else if(r)if(i)for(let t=0;t<c;t++){const l=a[t];this._matchLeaves(s,l,{warn:this.#a})&&(n.push(l),o=!0)}else n=[].slice.call(a),o=!0;else i?b=!0:(n=[].slice.call(a),o=!0);return[n,o,b]}_findEntryNodes(a,e,r){const{leaves:i}=a,[s,...n]=i,{type:o}=s,b=(0,S.unescapeSelector)(s.name),c=n.length>0;let t=[],l=!1,h=!1;switch(o){case f.SELECTOR_PSEUDO_ELEMENT:{(0,M.matchPseudoElementSelector)(b,{warn:this.#a});break}case f.SELECTOR_ID:{if(e===D)[t,l]=this._matchSelf(i);else if(e===R)[t,l]=this._findLineal(i,{complex:r});else if(e===$&&this.#s.nodeType!==f.ELEMENT_NODE){const d=this.#s.getElementById(b);d&&(c?this._matchLeaves(n,d,{warn:this.#a})&&(t.push(d),l=!0):(t.push(d),l=!0))}else h=!0;break}case f.SELECTOR_CLASS:{if(e===D)[t,l]=this._matchSelf(i);else if(e===R)[t,l]=this._findLineal(i,{complex:r});else if(e===$)[t,l]=this._findFirst(i);else if(this.#s.nodeType===f.DOCUMENT_NODE){const d=this.#s.getElementsByClassName(b);[t,l,h]=this._findFromHTMLCollection(d,{complex:r,compound:c,filterLeaves:n})}else h=!0;break}case f.SELECTOR_TYPE:{if(e===D)[t,l]=this._matchSelf(i);else if(e===R)[t,l]=this._findLineal(i,{complex:r});else if(this.#t.contentType==="text/html"&&this.#s.nodeType===f.DOCUMENT_NODE&&!/[*|]/.test(b)){const d=this.#s.getElementsByTagName(b);[t,l,h]=this._findFromHTMLCollection(d,{complex:r,compound:c,filterLeaves:n})}else h=!0;break}default:if(e!==R&&f.REG_SHADOW_HOST.test(b)){if(this.#h&&this.#e.nodeType===f.DOCUMENT_FRAGMENT_NODE){const d=this._matchShadowHostPseudoClass(s,this.#e);d&&(t.push(d),l=!0)}}else e===D?[t,l]=this._matchSelf(i):e===R?[t,l]=this._findLineal(i,{complex:r}):e===$?[t,l]=this._findFirst(i):h=!0}return{compound:c,filtered:l,nodes:t,pending:h}}_getEntryTwig(a,e){const r=a.length,i=r>1,s=a[0];let n,o;if(i){const{combo:b,leaves:[{name:c,type:t}]}=s,l=a[r-1],{leaves:[{name:h,type:d}]}=l;if(d===f.SELECTOR_PSEUDO_ELEMENT||d===f.SELECTOR_ID)n=O,o=l;else if(t===f.SELECTOR_PSEUDO_ELEMENT||t===f.SELECTOR_ID)n=C,o=s;else if(e===L)if(c==="*"&&t===f.SELECTOR_TYPE)n=O,o=l;else if(h==="*"&&d===f.SELECTOR_TYPE)n=C,o=s;else if(r===2){const{name:w}=b;/^[+~]$/.test(w)?(n=O,o=l):(n=C,o=s)}else n=C,o=s;else if(h==="*"&&d===f.SELECTOR_TYPE)n=C,o=s;else if(c==="*"&&t===f.SELECTOR_TYPE)n=O,o=l;else{let w,m;for(const{combo:k,leaves:[_]}of a){const{type:y}=_,u=(0,S.unescapeSelector)(_.name);if(y===f.SELECTOR_PSEUDO_CLASS&&u==="dir"){w=!1;break}if(k&&!m){const{name:p}=k;/^[+~]$/.test(p)&&(w=!0,m=!0)}}w?(n=C,o=s):(n=O,o=l)}}else n=O,o=s;return{complex:i,dir:n,twig:o}}_collectNodes(a){const e=this.#l.values();if(a===L||a===$){const r=new Set;let i=0;for(const{branch:s}of e){const{complex:n,dir:o,twig:b}=this._getEntryTwig(s,a),{compound:c,filtered:t,nodes:l,pending:h}=this._findEntryNodes(b,a,n);l.length?(this.#l[i].find=!0,this.#c[i]=l):h&&r.add(new Map([["index",i],["twig",b]])),this.#l[i].dir=o,this.#l[i].filtered=t||!c,i++}if(r.size){let s,n;this.#e!==this.#s&&this.#e.nodeType===f.ELEMENT_NODE?(s=this.#e,n=this.#n):(s=this.#s,n=this.#b);let o=this._traverse(s,n);for(;o;){let b=!1;if(this.#e.nodeType===f.ELEMENT_NODE?o===this.#e?b=!0:b=this.#e.contains(o):b=!0,b)for(const c of r){const{leaves:t}=c.get("twig");if(this._matchLeaves(t,o,{warn:this.#a})){const h=c.get("index");this.#l[h].filtered=!0,this.#l[h].find=!0,this.#c[h].push(o)}}o=n.nextNode()}}}else{let r=0;for(const{branch:i}of e){const s=i[i.length-1],n=i.length>1,{compound:o,filtered:b,nodes:c}=this._findEntryNodes(s,a,n);c.length&&(this.#l[r].find=!0,this.#c[r]=c),this.#l[r].dir=O,this.#l[r].filtered=b||!o,r++}}return[this.#l,this.#c]}_matchNodes(a){const[...e]=this.#l,r=e.length;let i=new Set;for(let s=0;s<r;s++){const{branch:n,dir:o,find:b}=e[s],c=n.length;if(c&&b){const t=this.#c[s],l=t.length,h=c-1;if(h===0){const{leaves:d}=n[0],w=d.length>1;if((a===L||a===$)&&this.#e.nodeType===f.ELEMENT_NODE)for(let m=0;m<l;m++){const k=t[m];if(k!==this.#e&&this.#e.contains(k)&&(i.add(k),a!==L))break}else if(w)for(let m=0;m<l;m++){const k=t[m];if(i.add(k),a!==L)break}else if(a===L)if(i.size){const m=[...i];i=new Set([...m,...t]),this.#d=!0}else i=new Set([...t]);else{const[m]=[...t];i.add(m)}}else if(o===C){let{combo:d,leaves:w}=n[0],m;for(let k=0;k<l;k++){const _=t[k];let y=new Set([_]);for(let u=1;u<c;u++){const{combo:p,leaves:g}=n[u],N=[];for(const E of y){const T={combo:d,leaves:g},v=this._matchCombinator(T,E,{dir:o,warn:this.#a});v.size&&N.push(...v)}if(N.length)if(u===h){if(a===L){if(i.size){const E=[...i];i=new Set([...E,...N])}else i=new Set([...N]);this.#d=!0}else{const[E]=(0,A.sortNodes)(N);i.add(E)}m=!0}else d=p,y=new Set(N),m=!1;else{m=!1;break}}if(m&&a!==L)break}if(!m&&a===$){const[k]=[...t];let _=this._findNode(w,{node:k});for(;_;){let y=new Set([_]);for(let u=1;u<c;u++){const{combo:p,leaves:g}=n[u],N=[];for(const E of y){const T={combo:d,leaves:g},v=this._matchCombinator(T,E,{dir:o,warn:this.#a});v.size&&N.push(...v)}if(N.length)if(u===h){const[E]=(0,A.sortNodes)(N);i.add(E),m=!0}else d=p,y=new Set(N),m=!1;else{m=!1;break}}if(m)break;_=this._findNode(w,{node:_}),y=new Set([_])}}}else{const{leaves:d}=n[h];let w;for(let m=0;m<l;m++){const k=t[m];let _=new Set([k]);for(let y=h-1;y>=0;y--){const u=n[y],p=[];for(const g of _){const N=this._matchCombinator(u,g,{dir:o,warn:this.#a});N.size&&p.push(...N)}if(p.length)y===0?(i.add(k),w=!0,a===L&&c>1&&i.size>1&&(this.#d=!0)):(_=new Set(p),w=!1);else{w=!1;break}}if(w&&a!==L)break}if(!w&&a===$){const[m]=[...t];let k=this._findNode(d,{node:m});for(;k;){let _=new Set([k]);for(let y=h-1;y>=0;y--){const u=n[y],p=[];for(const g of _){const N=this._matchCombinator(u,g,{dir:o,warn:this.#a});N.size&&p.push(...N)}if(p.length)y===0?(i.add(k),w=!0):(_=new Set(p),w=!1);else{w=!1;break}}if(w)break;k=this._findNode(d,{node:k}),_=new Set([k])}}}}}return i}_find(a){return this._collectNodes(a),this._matchNodes(a)}matches(a,e,r){let i;try{if(e.nodeType!==f.ELEMENT_NODE){const s=`Unexpected node ${e.nodeName}`;throw new TypeError(s)}this.#e=this._setup(a,e,r,!0),this.#i===this.#t&&(0,S.filterSelector)(a)?i=this.#o.match(a,e):(this._correspond(a),i=this._find(D).size)}catch(s){this._onError(s)}return!!i}closest(a,e,r){let i;try{if(e.nodeType!==f.ELEMENT_NODE){const s=`Unexpected node ${e.nodeName}`;throw new TypeError(s)}if(this.#e=this._setup(a,e,r,!0),this.#i===this.#t&&(0,S.filterSelector)(a))i=this.#o.closest(a,e);else{this._correspond(a);const s=this._find(R);if(s.size){let n=this.#e;for(;n;){if(s.has(n)){i=n;break}n=n.parentNode}}}}catch(s){this._onError(s)}return i??null}querySelector(a,e,r){let i;try{if(this.#e=this._setup(a,e,r),this.#i===this.#t&&this.#u&&!this.#f&&(0,S.filterSelector)(a))i=this.#o.first(a,e);else{this._prepareTreeWalkers(e);const s=this._find($);s.delete(this.#e),s.size&&([i]=(0,A.sortNodes)(s))}}catch(s){this._onError(s)}return i??null}querySelectorAll(a,e,r){let i;try{if(this.#e=this._setup(a,e,r),this.#i===this.#t&&!this.#f&&(0,S.filterSelector)(a))i=this.#o.select(a,e);else{this._prepareTreeWalkers(e);const s=this._find(L);s.delete(this.#e),s.size&&(this.#d?i=(0,A.sortNodes)(s):i=[...s])}}catch(s){this._onError(s)}return i??[]}}0&&(module.exports={Finder});
//# sourceMappingURL=finder.js.map
