var T=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var A=(x,t)=>{for(var e in t)T(x,e,{get:t[e],enumerable:!0})},_=(x,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of S(t))!O.call(x,r)&&r!==e&&T(x,r,{get:()=>t[r],enumerable:!(n=L(t,r))||n.enumerable});return x};var R=x=>_(T({},"__esModule",{value:!0}),x);var C={};A(C,{Matcher:()=>k,default:()=>P,matcher:()=>N});module.exports=R(C);var y=require("./dom-util.js"),b=require("./parser.js"),s=require("./constant.js");class k{matchPseudoElementSelector(t,e={}){if(!t||typeof t!="string"){const o=`Unexpected type ${Object.prototype.toString.call(t).slice(s.TYPE_FROM,s.TYPE_TO)}`;throw new TypeError(o)}const{forgive:n,warn:r}=e;switch(t){case"after":case"backdrop":case"before":case"cue":case"cue-region":case"first-letter":case"first-line":case"file-selector-button":case"marker":case"placeholder":case"selection":case"target-text":{if(r){const a=`Unsupported pseudo-element ::${t}`;throw new DOMException(a,s.NOT_SUPPORTED_ERR)}break}case"part":case"slotted":{if(r){const a=`Unsupported pseudo-element ::${t}()`;throw new DOMException(a,s.NOT_SUPPORTED_ERR)}break}default:if(t.startsWith("-webkit-")){if(r){const a=`Unsupported pseudo-element ::${t}`;throw new DOMException(a,s.NOT_SUPPORTED_ERR)}}else if(!n){const a=`Unknown pseudo-element ::${t}`;throw new DOMException(a,s.SYNTAX_ERR)}}}_matchAttributeSelector(t,e){const{flags:n,matcher:r,name:a,value:o}=t;if(typeof n=="string"&&!/^[is]$/i.test(n)){const c=`Invalid selector ${(0,b.generateCSS)(t)}`;throw new DOMException(c,s.SYNTAX_ERR)}const{attributes:w}=e;let h;if(w&&w.length){const d=e.ownerDocument.contentType;let c;d==="text/html"?typeof n=="string"&&/^s$/i.test(n)?c=!1:c=!0:typeof n=="string"&&/^i$/i.test(n)?c=!0:c=!1;let g=(0,b.unescapeSelector)(a.name);c&&(g=g.toLowerCase());const f=new Set;if(g.indexOf("|")>-1){const{prefix:p,localName:u}=(0,b.parseAstName)(g);for(const i of w){let{name:l,value:m}=i;switch(c&&(l=l.toLowerCase(),m=m.toLowerCase()),p){case"":{u===l&&f.add(m);break}case"*":{l.indexOf(":")>-1?l.endsWith(`:${u}`)&&f.add(m):u===l&&f.add(m);break}default:if(l.indexOf(":")>-1){const[$,E]=l.split(":");if($==="xml"&&E==="lang")continue;p===$&&u===E&&(0,y.isNamespaceDeclared)(p,e)&&f.add(m)}}}}else for(let{name:p,value:u}of w)if(c&&(p=p.toLowerCase(),u=u.toLowerCase()),p.indexOf(":")>-1){const[i,l]=p.split(":");if(i==="xml"&&l==="lang")continue;g===l&&f.add(u)}else g===p&&f.add(u);if(f.size){const{name:p,value:u}=o??{};let i;switch(p?c?i=p.toLowerCase():i=p:u?c?i=u.toLowerCase():i=u:u===""&&(i=u),r){case"=":{typeof i=="string"&&f.has(i)&&(h=e);break}case"~=":{if(i&&typeof i=="string"){for(const l of f)if(new Set(l.split(/\s+/)).has(i)){h=e;break}}break}case"|=":{if(i&&typeof i=="string"){let l;for(const m of f)if(m===i||m.startsWith(`${i}-`)){l=m;break}l&&(h=e)}break}case"^=":{if(i&&typeof i=="string"){let l;for(const m of f)if(m.startsWith(`${i}`)){l=m;break}l&&(h=e)}break}case"$=":{if(i&&typeof i=="string"){let l;for(const m of f)if(m.endsWith(`${i}`)){l=m;break}l&&(h=e)}break}case"*=":{if(i&&typeof i=="string"){let l;for(const m of f)if(m.includes(`${i}`)){l=m;break}l&&(h=e)}break}case null:default:h=e}}}return h??null}_matchTypeSelector(t,e,n={}){const r=(0,b.unescapeSelector)(t.name),{localName:a,namespaceURI:o,prefix:w}=e,{forgive:h}=n;let{prefix:d,localName:c}=(0,b.parseAstName)(r,e);e.ownerDocument.contentType==="text/html"&&s.REG_TAG_NAME.test(a)&&(d=d.toLowerCase(),c=c.toLowerCase());let g,f;a.indexOf(":")>-1?[g,f]=a.split(":"):(g=w||"",f=a);let p;switch(d){case"":{!g&&!o&&(c==="*"||c===f)&&(p=e);break}case"*":{(c==="*"||c===f)&&(p=e);break}default:{const u=e.lookupNamespaceURI(d),i=e.lookupNamespaceURI(g);if(u===i&&d===g)(c==="*"||c===f)&&(p=e);else if(!h&&!u){const l=`Undeclared namespace ${d}`;throw new DOMException(l,s.SYNTAX_ERR)}}}return p??null}_matchDirectionPseudoClass(t,e){const n=(0,y.getDirectionality)(e);let r;return t.name===n&&(r=e),r??null}_matchLanguagePseudoClass(t,e){if(t.name===s.EMPTY)return null;const n=(0,b.unescapeSelector)(t.name);typeof n=="string"&&n!==t.name&&(t.name=n);let r;if(n==="*")if(e.hasAttribute("lang"))e.getAttribute("lang")&&(r=e);else{let a=e.parentNode;for(;a&&a.nodeType===s.ELEMENT_NODE;){if(a.hasAttribute("lang")){a.getAttribute("lang")&&(r=e);break}a=a.parentNode}}else if(n&&s.REG_LANG.test(n)){let a;if(n.indexOf("-")>-1){const[o,w,...h]=n.split("-");let d;o==="*"?d=`${s.ALPHA_NUM}${s.LANG_PART}`:d=`${o}${s.LANG_PART}`;const c=`-${w}${s.LANG_PART}`,g=h.length;let f="";if(g)for(let p=0;p<g;p++)f+=`-${h[p]}${s.LANG_PART}`;a=new RegExp(`^${d}${c}${f}$`,"i")}else a=new RegExp(`^${n}${s.LANG_PART}$`,"i");if(e.hasAttribute("lang"))a.test(e.getAttribute("lang"))&&(r=e);else{let o=e.parentNode;for(;o&&o.nodeType===s.ELEMENT_NODE;){if(o.hasAttribute("lang")){const w=o.getAttribute("lang");a.test(w)&&(r=e);break}o=o.parentNode}}}return r??null}matchSelector(t,e,n){if(!t||!t.type){const o=`Unexpected node ${Object.prototype.toString.call(t).slice(s.TYPE_FROM,s.TYPE_TO)}`;throw new TypeError(o)}else if(!e||!e.nodeType){const o=`Unexpected node ${Object.prototype.toString.call(e).slice(s.TYPE_FROM,s.TYPE_TO)}`;throw new TypeError(o)}else if(e.nodeType!==s.ELEMENT_NODE){const a=`Unexpected node ${e.nodeName}`;throw new TypeError(a)}let r;switch(t.type){case s.SELECTOR_ATTR:{r=this._matchAttributeSelector(t,e);break}case s.SELECTOR_TYPE:{r=this._matchTypeSelector(t,e,n);break}default:{const{children:[a],name:o}=t;o==="dir"?r=this._matchDirectionPseudoClass(a,e):o==="lang"&&(r=this._matchLanguagePseudoClass(a,e))}}return r}}const N=new k;var P=N;0&&(module.exports={Matcher,matcher});
//# sourceMappingURL=matcher.js.map
