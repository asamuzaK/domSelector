var b=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var k=(i,t)=>{for(var l in t)b(i,l,{get:t[l],enumerable:!0})},S=(i,t,l,d)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of y(t))!L.call(i,o)&&o!==l&&b(i,o,{get:()=>t[o],enumerable:!(d=E(t,o))||d.enumerable});return i};var A=i=>S(b({},"__esModule",{value:!0}),i);var C={};k(C,{matchAttributeSelector:()=>R,matchDirectionPseudoClass:()=>D,matchLanguagePseudoClass:()=>O,matchPseudoElementSelector:()=>T,matchTypeSelector:()=>v});module.exports=A(C);var x=require("./parser.js"),h=require("./utility.js"),s=require("./constant.js");const T=(i,t,l={})=>{const{forgive:d,warn:o}=l;if(t===s.PS_ELEMENT_SELECTOR)switch(i){case"after":case"backdrop":case"before":case"cue":case"cue-region":case"first-letter":case"first-line":case"file-selector-button":case"marker":case"placeholder":case"selection":case"target-text":{if(o)throw new DOMException(`Unsupported pseudo-element ::${i}`,s.NOT_SUPPORTED_ERR);break}case"part":case"slotted":{if(o)throw new DOMException(`Unsupported pseudo-element ::${i}()`,s.NOT_SUPPORTED_ERR);break}default:if(i.startsWith("-webkit-")){if(o)throw new DOMException(`Unsupported pseudo-element ::${i}`,s.NOT_SUPPORTED_ERR)}else if(!d)throw new DOMException(`Unknown pseudo-element ::${i}`,s.SYNTAX_ERR)}else throw new TypeError(`Unexpected ast type ${(0,h.getType)(t)}`)},D=(i,t)=>{const{name:l}=i;if(!l){let o;throw l===""?o="(empty String)":o=(0,h.getType)(l),new TypeError(`Unexpected ast type ${o}`)}const d=(0,h.getDirectionality)(t);return l===d},O=(i,t)=>{const{name:l,type:d,value:o}=i;let w;if(d===s.STRING&&o?w=o:d===s.IDENT&&l&&(w=(0,x.unescapeSelector)(l)),w==="*"){if(t.hasAttribute("lang"))return!!t.getAttribute("lang");{let m=t.parentNode,g;for(;m&&m.nodeType===s.ELEMENT_NODE;){if(m.hasAttribute("lang")){m.getAttribute("lang")&&(g=!0);break}m=m.parentNode}return!!g}}else if(w){if(new RegExp(`^(?:\\*-)?${s.ALPHA_NUM}${s.LANG_PART}$`,"i").test(w)){let g;if(w.indexOf("-")>-1){const[a,u,...c]=w.split("-");let f;a==="*"?f=`${s.ALPHA_NUM}${s.LANG_PART}`:f=`${a}${s.LANG_PART}`;const p=`-${u}${s.LANG_PART}`,e=c.length;let r="";if(e)for(let n=0;n<e;n++)r+=`-${c[n]}${s.LANG_PART}`;g=new RegExp(`^${f}${p}${r}$`,"i")}else g=new RegExp(`^${w}${s.LANG_PART}$`,"i");if(t.hasAttribute("lang"))return g.test(t.getAttribute("lang"));{let a=t.parentNode,u;for(;a&&a.nodeType===s.ELEMENT_NODE;){if(a.hasAttribute("lang")){u=g.test(a.getAttribute("lang"));break}a=a.parentNode}return!!u}}return!1}return!1},R=(i,t)=>{const{flags:l,matcher:d,name:o,value:w}=i;if(typeof l=="string"&&!/^[is]$/i.test(l)){const g=(0,x.generateCSS)(i);throw new DOMException(`Invalid selector ${g}`,s.SYNTAX_ERR)}const{attributes:m}=t;if(m&&m.length){const g=t.ownerDocument.contentType;let a;g==="text/html"?typeof l=="string"&&/^s$/i.test(l)?a=!1:a=!0:typeof l=="string"&&/^i$/i.test(l)?a=!0:a=!1;let u=(0,x.unescapeSelector)(o.name);a&&(u=u.toLowerCase());const c=new Set;if(u.indexOf("|")>-1){const{prefix:f,localName:p}=(0,x.parseAstName)(u);for(const e of m){let{name:r,value:n}=e;switch(a&&(r=r.toLowerCase(),n=n.toLowerCase()),f){case"":{p===r&&c.add(n);break}case"*":{r.indexOf(":")>-1?r.endsWith(`:${p}`)&&c.add(n):p===r&&c.add(n);break}default:if(r.indexOf(":")>-1){const[$,N]=r.split(":");if($==="xml"&&N==="lang")continue;f===$&&p===N&&(0,h.isNamespaceDeclared)(f,t)&&c.add(n)}}}}else for(let{name:f,value:p}of m)if(a&&(f=f.toLowerCase(),p=p.toLowerCase()),f.indexOf(":")>-1){const[e,r]=f.split(":");if(e==="xml"&&r==="lang")continue;u===r&&c.add(p)}else u===f&&c.add(p);if(c.size){const{name:f,value:p}=w??{};let e;switch(f?a?e=f.toLowerCase():e=f:p?a?e=p.toLowerCase():e=p:p===""&&(e=p),d){case"=":return typeof e=="string"&&c.has(e);case"~=":{if(e&&typeof e=="string"){let r;for(const n of c)if(new Set(n.split(/\s+/)).has(e)){r=!0;break}return!!r}return!1}case"|=":{if(e&&typeof e=="string"){let r;for(const n of c)if(n===e||n.startsWith(`${e}-`)){r=n;break}return!!r}return!1}case"^=":{if(e&&typeof e=="string"){let r;for(const n of c)if(n.startsWith(`${e}`)){r=n;break}return!!r}return!1}case"$=":{if(e&&typeof e=="string"){let r;for(const n of c)if(n.endsWith(`${e}`)){r=n;break}return!!r}return!1}case"*=":{if(e&&typeof e=="string"){let r;for(const n of c)if(n.includes(`${e}`)){r=n;break}return!!r}return!1}case null:default:return!0}}return!1}return!1},v=(i,t,l={})=>{const d=(0,x.unescapeSelector)(i.name),{localName:o,namespaceURI:w,prefix:m}=t,{forgive:g}=l;let{prefix:a,localName:u}=(0,x.parseAstName)(d,t);t.ownerDocument.contentType==="text/html"&&/[A-Z][\\w-]*/i.test(o)&&(a=a.toLowerCase(),u=u.toLowerCase());let c,f;switch(o.indexOf(":")>-1?[c,f]=o.split(":"):(c=m||"",f=o),a){case"":return!c&&!w&&(u==="*"||u===f);case"*":return u==="*"||u===f;default:{const p=t.lookupNamespaceURI(a),e=t.lookupNamespaceURI(c);if(p===e&&a===c)return u==="*"||u===f;if(!g&&!p)throw new DOMException(`Undeclared namespace ${a}`,s.SYNTAX_ERR);return!1}}};0&&(module.exports={matchAttributeSelector,matchDirectionPseudoClass,matchLanguagePseudoClass,matchPseudoElementSelector,matchTypeSelector});
//# sourceMappingURL=matcher.js.map
