var y=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var N=(t,e)=>{for(var c in e)y(t,c,{get:e[c],enumerable:!0})},_=(t,e,c,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of D(e))!C.call(t,r)&&r!==c&&y(t,r,{get:()=>e[r],enumerable:!(i=$(e,r))||i.enumerable});return t};var v=t=>_(y({},"__esModule",{value:!0}),t);var U={};N(U,{_matchAttributeSelector:()=>k,_matchClassSelector:()=>O,_matchIDSelector:()=>S,_matchTypeSelector:()=>L,matchPseudoElementSelector:()=>P,matchSelector:()=>R});module.exports=v(U);var T=require("./dom-util.js"),d=require("./parser.js"),a=require("./constant.js");const k=(t,e)=>{const{flags:c,matcher:i,name:r,value:h}=t;if(typeof c=="string"&&!/^[is]$/i.test(c)){const n=`Invalid selector ${(0,d.generateCSS)(t)}`;throw new DOMException(n,a.SYNTAX_ERR)}const{attributes:x}=e;let w;if(x&&x.length){const g=e.ownerDocument.contentType;let n;g==="text/html"?typeof c=="string"&&/^s$/i.test(c)?n=!1:n=!0:typeof c=="string"&&/^i$/i.test(c)?n=!0:n=!1;let u=(0,d.unescapeSelector)(r.name);n&&(u=u.toLowerCase());const f=new Set;if(u.indexOf("|")>-1){const{prefix:p,localName:m}=(0,d.parseAstName)(u);for(const s of x){let{name:o,value:l}=s;switch(n&&(o=o.toLowerCase(),l=l.toLowerCase()),p){case"":{m===o&&f.add(l);break}case"*":{o.indexOf(":")>-1?o.endsWith(`:${m}`)&&f.add(l):m===o&&f.add(l);break}default:if(o.indexOf(":")>-1){const[b,E]=o.split(":");if(b==="xml"&&E==="lang")continue;p===b&&m===E&&(0,T.isNamespaceDeclared)(p,e)&&f.add(l)}}}}else for(let{name:p,value:m}of x)if(n&&(p=p.toLowerCase(),m=m.toLowerCase()),p.indexOf(":")>-1){const[s,o]=p.split(":");if(s==="xml"&&o==="lang")continue;u===o&&f.add(m)}else u===p&&f.add(m);if(f.size){const{name:p,value:m}=h??{};let s;switch(p?n?s=p.toLowerCase():s=p:m?n?s=m.toLowerCase():s=m:m===""&&(s=m),i){case"=":{typeof s=="string"&&f.has(s)&&(w=e);break}case"~=":{if(s&&typeof s=="string"){for(const o of f)if(new Set(o.split(/\s+/)).has(s)){w=e;break}}break}case"|=":{if(s&&typeof s=="string"){let o;for(const l of f)if(l===s||l.startsWith(`${s}-`)){o=l;break}o&&(w=e)}break}case"^=":{if(s&&typeof s=="string"){let o;for(const l of f)if(l.startsWith(`${s}`)){o=l;break}o&&(w=e)}break}case"$=":{if(s&&typeof s=="string"){let o;for(const l of f)if(l.endsWith(`${s}`)){o=l;break}o&&(w=e)}break}case"*=":{if(s&&typeof s=="string"){let o;for(const l of f)if(l.includes(`${s}`)){o=l;break}o&&(w=e)}break}case null:default:w=e}}}return w??null},O=(t,e)=>{const c=(0,d.unescapeSelector)(t.name);let i;return e.classList.contains(c)&&(i=e),i??null},S=(t,e)=>{const c=(0,d.unescapeSelector)(t.name);let i;return c===e.id&&(i=e),i??null},L=(t,e,c={})=>{const i=(0,d.unescapeSelector)(t.name),{localName:r,namespaceURI:h,prefix:x}=e,{forgive:w}=c;let{prefix:g,localName:n}=(0,d.parseAstName)(i,e);e.ownerDocument.contentType==="text/html"&&(g=g.toLowerCase(),n=n.toLowerCase());let u,f;r.indexOf(":")>-1?[u,f]=r.split(":"):(u=x||"",f=r);let p;switch(g){case"":{u===""&&h===null&&(n==="*"||n===f)&&(p=e);break}case"*":{(n==="*"||n===f)&&(p=e);break}default:if((0,T.isNamespaceDeclared)(g,e))g===u&&(n==="*"||n===f)&&(p=e);else if(!w){const s=`Undeclared namespace ${g}`;throw new DOMException(s,a.SYNTAX_ERR)}}return p??null},R=(t,e,c)=>{if(!t||!t.type){const h=`Unexpected node ${Object.prototype.toString.call(t).slice(a.TYPE_FROM,a.TYPE_TO)}`;throw new TypeError(h)}else if(!e||!e.nodeType){const h=`Unexpected node ${Object.prototype.toString.call(e).slice(a.TYPE_FROM,a.TYPE_TO)}`;throw new TypeError(h)}else if(e.nodeType!==a.ELEMENT_NODE){const r=`Unexpected node ${e.nodeName}`;throw new TypeError(r)}let i;switch(t.type){case a.SELECTOR_ATTR:{i=k(t,e);break}case a.SELECTOR_CLASS:{i=O(t,e);break}case a.SELECTOR_ID:{i=S(t,e);break}case a.SELECTOR_TYPE:default:i=L(t,e,c)}return i},P=(t,e={})=>{if(!t||typeof t!="string"){const h=`Unexpected type ${Object.prototype.toString.call(t).slice(a.TYPE_FROM,a.TYPE_TO)}`;throw new TypeError(h)}const{forgive:c,warn:i}=e;switch(t){case"after":case"backdrop":case"before":case"cue":case"cue-region":case"first-letter":case"first-line":case"file-selector-button":case"marker":case"placeholder":case"selection":case"target-text":{if(i){const r=`Unsupported pseudo-element ::${t}`;throw new DOMException(r,a.NOT_SUPPORTED_ERR)}break}case"part":case"slotted":{if(i){const r=`Unsupported pseudo-element ::${t}()`;throw new DOMException(r,a.NOT_SUPPORTED_ERR)}break}default:if(t.startsWith("-webkit-")){if(i){const r=`Unsupported pseudo-element ::${t}`;throw new DOMException(r,a.NOT_SUPPORTED_ERR)}}else if(!c){const r=`Unknown pseudo-element ::${t}`;throw new DOMException(r,a.SYNTAX_ERR)}}};0&&(module.exports={_matchAttributeSelector,_matchClassSelector,_matchIDSelector,_matchTypeSelector,matchPseudoElementSelector,matchSelector});
//# sourceMappingURL=matcher.js.map
