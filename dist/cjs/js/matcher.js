var b=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var k=(n,t)=>{for(var l in t)b(n,l,{get:t[l],enumerable:!0})},S=(n,t,l,m)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of y(t))!L.call(n,o)&&o!==l&&b(n,o,{get:()=>t[o],enumerable:!(m=E(t,o))||m.enumerable});return n};var A=n=>S(b({},"__esModule",{value:!0}),n);var C={};k(C,{matchAttributeSelector:()=>R,matchDirectionPseudoClass:()=>D,matchLanguagePseudoClass:()=>O,matchPseudoElementSelector:()=>T,matchTypeSelector:()=>v});module.exports=A(C);var x=require("./parser.js"),h=require("./utility.js"),s=require("./constant.js");const T=(n,t,l={})=>{const{forgive:m,warn:o}=l;if(t===s.PS_ELEMENT_SELECTOR)switch(n){case"after":case"backdrop":case"before":case"cue":case"cue-region":case"first-letter":case"first-line":case"file-selector-button":case"marker":case"placeholder":case"selection":case"target-text":{if(o)throw new DOMException(`Unsupported pseudo-element ::${n}`,s.NOT_SUPPORTED_ERR);break}case"part":case"slotted":{if(o)throw new DOMException(`Unsupported pseudo-element ::${n}()`,s.NOT_SUPPORTED_ERR);break}default:if(n.startsWith("-webkit-")){if(o)throw new DOMException(`Unsupported pseudo-element ::${n}`,s.NOT_SUPPORTED_ERR)}else if(!m)throw new DOMException(`Unknown pseudo-element ::${n}`,s.SYNTAX_ERR)}else throw new TypeError(`Unexpected ast type ${(0,h.getType)(t)}`)},D=(n,t)=>{const{name:l}=n;if(!l){let o;throw l===""?o="(empty String)":o=(0,h.getType)(l),new TypeError(`Unexpected ast type ${o}`)}const m=(0,h.getDirectionality)(t);return l===m},O=(n,t)=>{const{name:l,type:m,value:o}=n;let w;if(m===s.STRING&&o?w=o:m===s.IDENT&&l&&(w=(0,x.unescapeSelector)(l)),w==="*")if(t.hasAttribute("lang")){if(t.getAttribute("lang"))return!0}else{let d=t.parentNode,g;for(;d&&d.nodeType===s.ELEMENT_NODE;){if(d.hasAttribute("lang")){d.getAttribute("lang")&&(g=!0);break}d=d.parentNode}return!!g}else if(w&&new RegExp(`^(?:\\*-)?${s.ALPHA_NUM}${s.LANG_PART}$`,"i").test(w)){let g;if(w.indexOf("-")>-1){const[a,u,...c]=w.split("-");let f;a==="*"?f=`${s.ALPHA_NUM}${s.LANG_PART}`:f=`${a}${s.LANG_PART}`;const p=`-${u}${s.LANG_PART}`,e=c.length;let r="";if(e)for(let i=0;i<e;i++)r+=`-${c[i]}${s.LANG_PART}`;g=new RegExp(`^${f}${p}${r}$`,"i")}else g=new RegExp(`^${w}${s.LANG_PART}$`,"i");if(t.hasAttribute("lang"))return g.test(t.getAttribute("lang"));{let a=t.parentNode,u;for(;a&&a.nodeType===s.ELEMENT_NODE;){if(a.hasAttribute("lang")){u=g.test(a.getAttribute("lang"));break}a=a.parentNode}return!!u}}return!1},R=(n,t)=>{const{flags:l,matcher:m,name:o,value:w}=n;if(typeof l=="string"&&!/^[is]$/i.test(l)){const g=(0,x.generateCSS)(n);throw new DOMException(`Invalid selector ${g}`,s.SYNTAX_ERR)}const{attributes:d}=t;if(d?.length){const g=t.ownerDocument.contentType;let a;g==="text/html"?typeof l=="string"&&/^s$/i.test(l)?a=!1:a=!0:typeof l=="string"&&/^i$/i.test(l)?a=!0:a=!1;let u=(0,x.unescapeSelector)(o.name);a&&(u=u.toLowerCase());const c=new Set;if(u.indexOf("|")>-1){const{prefix:f,localName:p}=(0,x.parseAstName)(u);for(const e of d){let{name:r,value:i}=e;switch(a&&(r=r.toLowerCase(),i=i.toLowerCase()),f){case"":{p===r&&c.add(i);break}case"*":{r.indexOf(":")>-1?r.endsWith(`:${p}`)&&c.add(i):p===r&&c.add(i);break}default:if(r.indexOf(":")>-1){const[$,N]=r.split(":");if($==="xml"&&N==="lang")continue;f===$&&p===N&&(0,h.isNamespaceDeclared)(f,t)&&c.add(i)}}}}else for(let{name:f,value:p}of d)if(a&&(f=f.toLowerCase(),p=p.toLowerCase()),f.indexOf(":")>-1){const[e,r]=f.split(":");if(e==="xml"&&r==="lang")continue;u===r&&c.add(p)}else u===f&&c.add(p);if(c.size){const{name:f,value:p}=w??{};let e;switch(f?a?e=f.toLowerCase():e=f:p?a?e=p.toLowerCase():e=p:p===""&&(e=p),m){case"=":return typeof e=="string"&&c.has(e);case"~=":{if(e&&typeof e=="string"){let r;for(const i of c)if(new Set(i.split(/\s+/)).has(e)){r=!0;break}return!!r}return!1}case"|=":{if(e&&typeof e=="string"){let r;for(const i of c)if(i===e||i.startsWith(`${e}-`)){r=i;break}return!!r}return!1}case"^=":{if(e&&typeof e=="string"){let r;for(const i of c)if(i.startsWith(`${e}`)){r=i;break}return!!r}return!1}case"$=":{if(e&&typeof e=="string"){let r;for(const i of c)if(i.endsWith(`${e}`)){r=i;break}return!!r}return!1}case"*=":{if(e&&typeof e=="string"){let r;for(const i of c)if(i.includes(`${e}`)){r=i;break}return!!r}return!1}case null:default:return!0}}}return!1},v=(n,t,l={})=>{const m=(0,x.unescapeSelector)(n.name),{localName:o,namespaceURI:w,prefix:d}=t,{forgive:g}=l;let{prefix:a,localName:u}=(0,x.parseAstName)(m,t);t.ownerDocument.contentType==="text/html"&&/[A-Z][\\w-]*/i.test(o)&&(a=a.toLowerCase(),u=u.toLowerCase());let c,f;switch(o.indexOf(":")>-1?[c,f]=o.split(":"):(c=d||"",f=o),a){case"":return!c&&!w&&(u==="*"||u===f);case"*":return u==="*"||u===f;default:{const p=t.lookupNamespaceURI(a),e=t.lookupNamespaceURI(c);if(p===e&&a===c)return u==="*"||u===f;if(!g&&!p)throw new DOMException(`Undeclared namespace ${a}`,s.SYNTAX_ERR);return!1}}};0&&(module.exports={matchAttributeSelector,matchDirectionPseudoClass,matchLanguagePseudoClass,matchPseudoElementSelector,matchTypeSelector});
//# sourceMappingURL=matcher.js.map
