var ut=Object.create;var ie=Object.defineProperty;var pt=Object.getOwnPropertyDescriptor;var dt=Object.getOwnPropertyNames;var mt=Object.getPrototypeOf,bt=Object.prototype.hasOwnProperty;var Et=(c,t)=>{for(var e in t)ie(c,e,{get:t[e],enumerable:!0})},Pe=(c,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of dt(t))!bt.call(c,s)&&s!==e&&ie(c,s,{get:()=>t[s],enumerable:!(o=pt(t,s))||o.enumerable});return c};var we=(c,t,e)=>(e=c!=null?ut(mt(c)):{},Pe(t||!c||!c.__esModule?ie(e,"default",{value:c,enumerable:!0}):e,c)),xt=c=>Pe(ie({},"__esModule",{value:!0}),c);var Bt={};Et(Bt,{DOMSelector:()=>Re});module.exports=xt(Bt);var U=require("css-tree");var Qe=we(require("@asamuzakjp/nwsapi"),1),Ze=we(require("bidi-js"),1),Oe=require("css-tree"),Se=we(require("is-potential-custom-element-name"),1);var B="AttributeSelector",j="ClassSelector",v="Combinator",We="Identifier",R="IdSelector",C="NotSupportedError",ne="Nth";var k="PseudoClassSelector",O="PseudoElementSelector";var Ye="Selector";var Ke="String",N="SyntaxError",L="all",S="first",$="lineal",D="self",F="TypeSelector";var ae="[A-Z\\d]+",wt="(?:first|last|only)-(?:child|of-type)",ye="(?:0|[1-9]\\d*)",G=`(?:-${ae})*`,V=`(?:any-)?link|${wt}|checked|empty|indeterminate|read-(?:only|write)|root|target`,yt=`[+-]?(?:${ye}n?|n)|(?:[+-]?${ye})?n\\s*[+-]\\s*${ye}`,X=`nth-(?:last-)?(?:child|of-type)\\(\\s*(?:even|odd|${yt})\\s*\\)`,oe="\\[[^|\\]]+\\]|[#.:][\\w-]+",Nt="\\[[^|\\]]+\\]|[#.][\\w-]+",ze="(?:[A-Za-z][\\w-]*|[#.][\\w-]+)",I="\\*|[A-Za-z][\\w-]*",Ue="\\*|[A-Z][\\w-]*",re=`(?:${I}|(?:${I})?(?:${oe})+)`,Tt=`(?:${I}|(?:${I})?(?:${Nt})+)`,le="\\s?[\\s>~+]\\s?",Me=`${re}(?:${le}${re})*`,Be="\\s?[\\s>]\\s?",_t=`:is\\(\\s*${re}(?:\\s*,\\s*${re})*\\s*\\)`,gt=`:is\\(\\s*${Me}(?:\\s*,\\s*${Me})*\\s*\\)`,Fe=`(?:${I}|(?:${I})?(?:${oe}|${_t})+)`,Ge=`(?:${I}|(?:${I})?(?:${oe}|${gt})+)`,q=`(?:${Ue}|(?:${Ue})?(?:${oe})+)`,He=`${Ge}(?:${le}${Ge})*`,je=`(?:is|not)\\(\\s*${He}(?:\\s*,\\s*${He})*\\s*\\)`,Ne=`(?:is|not)\\(\\s*${Fe}(?:\\s*,\\s*${Fe})*\\s*\\)`,Te=`has\\([\\s>]?\\s*${Tt}\\s*\\)`,ce=Object.freeze(["button","input","select","textarea"]),Ve=Object.freeze(["button","reset","submit"]),_e=Object.freeze(["date","datetime-local","month","time","week"]),Q=Object.freeze(["email","password","search","tel","text","url"]),Z=Object.freeze([..._e,...Q,"number"]),Vt=Object.freeze(["checkbox","color","date","image","number","range","radio","time"]),P=Object.freeze(["has","is","not","where"]),Xe=Object.freeze(["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Hyper","Meta","NumLock","ScrollLock","Shift","Super","Symbol","SymbolLock"]),qe=Object.freeze(["enabled","disabled","valid","invalid","in-range","out-of-range","checked","indeterminate","read-only","read-write","open","closed","placeholder-shown"]),fe=Object.freeze(["host","host-context"]);var Ct=new RegExp(`:(?!${V}|${X}|${je})`),Lt=new RegExp(`:(?!${V}|${X}|${Ne})`),$t=new RegExp(`:(?!${V}|${X}|${Ne}|${Te})`),vt=new RegExp(`:${Te}$`),Dt=new RegExp(`:(?!${V}|${X})`),T=c=>Object.prototype.toString.call(c).slice(8,-1);var Je=c=>{if(!c?.nodeType)throw new TypeError(`Unexpected type ${T(c)}`);let t,e,o;switch(c.nodeType){case 9:{t=c,e=c;break}case 11:{let{host:s,mode:a,ownerDocument:r}=c;t=r,e=c,o=s&&(a==="close"||a==="open");break}case 1:{t=c.ownerDocument;let s=c;for(;s;){let{host:a,mode:r,nodeType:f,parentNode:u}=s;if(f===11){o=a&&(r==="close"||r==="open");break}else if(u)s=u;else break}e=s;break}default:throw new TypeError(`Unexpected node ${c.nodeName}`)}return[t,e,!!o]},g=(c,t,e=!1)=>{if(!c?.nodeType)throw new TypeError(`Unexpected type ${T(c)}`);if(!t)return null;let o=t.currentNode;if(o===c)return o;if(e||o.contains(c)){for(o=t.nextNode();o&&o!==c;)o=t.nextNode();return o}else{if(o!==t.root){let s;for(;o;){if(o===c){s=!0;break}else if(o===t.root||o.contains(c))break;o=t.parentNode()}if(s)return o}if(c.nodeType===1){let s;for(;o;){if(o===c){s=!0;break}o=t.nextNode()}if(s)return o}}return null},ue=(c,t={})=>{if(!c?.nodeType)throw new TypeError(`Unexpected type ${T(c)}`);if(c.nodeType!==1)return!1;let{localName:e,ownerDocument:o}=c,{formAssociated:s}=t,a=o.defaultView,r,f=c.getAttribute("is");return f?r=(0,Se.default)(f)&&a.customElements.get(f):r=(0,Se.default)(e)&&a.customElements.get(e),r?s?!!r.formAssociated:!0:!1},ge=c=>{if(!c?.nodeType)throw new TypeError(`Unexpected type ${T(c)}`);if(typeof c.assignedNodes!="function")return null;let t=c.assignedNodes();if(t.length){let e;for(let o of t)if(e=o.textContent.trim(),e)break;return e}return c.textContent.trim()},he=c=>{if(!c?.nodeType)throw new TypeError(`Unexpected type ${T(c)}`);if(c.nodeType!==1)return null;let{dir:t,localName:e,parentNode:o}=c,{getEmbeddingLevels:s}=(0,Ze.default)();if(t==="ltr"||t==="rtl")return t;if(t==="auto"){let a;switch(e){case"input":{let r=[...Ve,...Q,"hidden"];if(!c.type||r.includes(c.type))a=c.value;else if(["checkbox","color","date","image","number","range","radio","time"].includes(c.type))return"ltr";break}case"slot":{a=ge(c);break}case"textarea":{a=c.value;break}default:{let r=[].slice.call(c.childNodes);for(let f of r){let{dir:u,localName:h,nodeType:n,textContent:i}=f;if(n===3?a=i.trim():n===1&&!["bdi","script","style","textarea"].includes(h)&&(!u||u!=="ltr"&&u!=="rtl")&&(h==="slot"?a=ge(f):a=i.trim()),a)break}}}if(a){let{paragraphs:[{level:r}]}=s(a);if(r%2===1)return"rtl"}else if(o){let{nodeType:r}=o;if(r===1)return he(o)}}else{if(e==="input"&&c.type==="tel")return"ltr";if(e==="bdi"){let a=c.textContent.trim();if(a){let{paragraphs:[{level:r}]}=s(a);if(r%2===1)return"rtl"}}else if(o){if(e==="slot"){let r=ge(c);if(r){let{paragraphs:[{level:f}]}=s(r);return f%2===1?"rtl":"ltr"}}let{nodeType:a}=o;if(a===1)return he(o)}}return"ltr"},ee=c=>{if(!c?.nodeType)throw new TypeError(`Unexpected type ${T(c)}`);if(c.nodeType!==1)return!1;if(typeof c.isContentEditable=="boolean")return c.isContentEditable;if(c.ownerDocument.designMode==="on")return!0;{let t;switch(c.hasAttribute("contenteditable")?t=c.getAttribute("contenteditable"):t="inherit",t){case"":case"true":return!0;case"plaintext-only":return!0;case"false":return!1;default:return c?.parentNode?.nodeType===1?ee(c.parentNode):!1}}},Ae=c=>{if(c?.nodeType!==1)return!1;let t=c.ownerDocument.defaultView,{display:e,visibility:o}=t.getComputedStyle(c);return e!=="none"&&o==="visible"},Ce=c=>{if(c?.nodeType!==1)return!1;let{localName:t,type:e}=c;switch(t){case"input":return!!(!e||Z.includes(e));case"textarea":return!0;default:return ee(c)}},pe=c=>{if(c?.nodeType!==1||!c.isConnected)return!1;let t=c.ownerDocument.defaultView;if(c instanceof t.HTMLElement){if(Number.isInteger(parseInt(c.getAttribute("tabindex")))||ee(c))return!0;let{localName:e,parentNode:o}=c;switch(e){case"a":return!!(c.href||c.hasAttribute("href"));case"iframe":return!0;case"input":return!(c.disabled||c.hasAttribute("disabled")||c.hidden||c.hasAttribute("hidden"));case"summary":{if(o.localName==="details"){let s=o.firstElementChild,a=!1;for(;s;){if(s.localName==="summary"){a=s===c;break}s=s.nextElementSibling}return a}return!1}default:if(["button","select","textarea"].includes(e)&&!(c.disabled||c.hasAttribute("disabled")))return!0}}else if(c instanceof t.SVGElement){if(Number.isInteger(parseInt(c.getAttributeNS(null,"tabindex")))){let e=["clipPath","defs","desc","linearGradient","marker","mask","metadata","pattern","radialGradient","script","style","symbol","title"],o="http://www.w3.org/2000/svg",s,a=c;for(;a.namespaceURI===o&&(s=e.includes(a.localName),!s);)if(a?.parentNode?.namespaceURI===o)a=a.parentNode;else break;return!s}if(c.localName==="a"&&(c.href||c.hasAttributeNS(null,"href")))return!0}return!1};var It=(c,t)=>{if(typeof c!="string")throw new TypeError(`Unexpected type ${T(c)}`);if(!t?.nodeType)throw new TypeError(`Unexpected type ${T(t)}`);if(!c||t.nodeType!==1)return null;let{attributes:e}=t,o;for(let s of e){let{name:a,namespaceURI:r,prefix:f,value:u}=s;if(a===`xmlns:${c}`?o=u:f===c&&(o=r),o)break}return o??null},et=(c="",t={})=>{if(!c||typeof c!="string"||t?.nodeType!==1)return!1;if(t.lookupNamespaceURI(c))return!0;let e=t.ownerDocument.documentElement,o=t,s;for(;o&&(s=It(c,o),!(s||o===e));)o=o.parentNode;return!!s},Rt=(c,t)=>{if(c?.nodeType){if(!t?.nodeType)throw new TypeError(`Unexpected type ${T(t)}`)}else throw new TypeError(`Unexpected type ${T(c)}`);if(c.nodeType!==1||t.nodeType!==1)return!1;let e=t.compareDocumentPosition(c);return!!(e&2||e&8)},de=(c=[])=>{let t=[...c];return t.length>1&&t.sort((e,o)=>{let s;return Rt(o,e)?s=1:s=-1,s}),t};var tt=(c,t)=>{if(!c?.DOMException)throw new TypeError(`Unexpected global object ${T(c)}`);t?.nodeType!==9&&(t=c.document);let e=(0,Qe.default)({document:t,DOMException:c.DOMException});return e.configure({LOGERRORS:!1}),e},te=(c,t={})=>{if(!c||typeof c!="string")return!1;let{complex:e,compound:o,descend:s,simple:a,target:r}=t;if(a||o)return!1;if(c.includes("[")){let f=c.lastIndexOf("[");if(c.substring(f).indexOf("]")<0)return!1}return/[|\\]|::|[^\u0021-\u007F\s]|\[\s*[\w$*=^|~-]+(?:(?:"[\w$*=^|~\s'-]+"|'[\w$*=^|~\s"-]+')?(?:\s+[\w$*=^|~-]+)+|"[^"\]]{1,255}|'[^'\]]{1,255})\s*\]|:(?:is|where)\(\s*\)/.test(c)?!1:c.includes(":")?s?!1:(r===D||r===$)&&/:has\(/.test(c)?!e||$t.test(c)?!1:vt.test(c):/:(?:is|not)\(/.test(c)?e?!Ct.test(c):!Lt.test(c):!Dt.test(c):!0};var _=require("css-tree"),it=/(?<=:(?:dir|has|host(?:-context)?|is|lang|not|nth-(?:last-)?(?:child|of-type)|where))\(\s+\)/g,Le=/^part|slotted$/,be="\uFFFD",M=(c="")=>{if(typeof c=="string"&&c.indexOf("\\",0)>=0){let t=c.split("\\"),e=t.length;for(let o=1;o<e;o++){let s=t[o];if(s===""&&o===e-1)s=be;else{let a=/^([\da-f]{1,6}\s?)/i.exec(s);if(a){let[,r]=a,f;try{let h=parseInt("D800",16),n=parseInt("DFFF",16),i=parseInt(r,16);i===0||i>=h&&i<=n?f=be:f=String.fromCodePoint(i)}catch{f=be}let u="";s.length>r.length&&(u=s.substring(r.length)),s=`${f}${u}`}else/^[\n\r\f]/.test(s)&&(s="\\"+s)}t[o]=s}c=t.join("")}return c},Yt=(...c)=>{if(!c.length)throw new TypeError("1 argument required, but only 0 present.");let[t]=c;if(typeof t=="string"){let e=0;for(;e>=0&&(e=t.indexOf("#",e),!(e<0));){let o=t.substring(0,e+1),s=t.substring(e+1);if(/^\d$/.test(s.substring(0,1)))throw new DOMException(`Invalid selector ${t}`,N);let a=s.codePointAt(0);if(a===45){if(/^\d$/.test(s.substring(1,2)))throw new DOMException(`Invalid selector ${t}`,N)}else if(a>65535){let r=`\\${a.toString(16)} `;s.length===2?s=r:s=`${r}${s.substring(2)}`}t=`${o}${s}`,e++}t=t.replace(/\f|\r\n?/g,`
`).replace(/[\0\uD800-\uDFFF]|\\$/g,be)}else if(t==null)t=T(t).toLowerCase();else if(Array.isArray(t))t=t.join(",");else if(Object.prototype.hasOwnProperty.call(t,"toString"))t=t.toString();else throw new DOMException(`Invalid selector ${t}`,N);return t.replace(/\x26/g,":scope")},H=c=>{if(c=Yt(c),/^$|^\s*>|,\s*$/.test(c))throw new DOMException(`Invalid selector ${c}`,N);let t;try{let e=(0,U.parse)(c,{context:"selectorList",parseCustomProperty:!0});t=(0,U.toPlainObject)(e)}catch(e){let{message:o}=e;if(/^(?:"\]"|Attribute selector [()\s,=~^$*|]+) is expected$/.test(o)&&!c.endsWith("]")){let s=c.lastIndexOf("["),a=c.substring(s);a.includes('"')?a.match(/"/g).length%2?t=H(`${c}"]`):t=H(`${c}]`):t=H(`${c}]`)}else if(o==='")" is expected')if(it.test(c))t=H(`${c.replaceAll(it,"()")}`);else if(!c.endsWith(")"))t=H(`${c})`);else throw new DOMException(`Invalid selector ${c}`,N);else throw new DOMException(`Invalid selector ${c}`,N)}return t},z=(c={})=>{let t=new Set,e=new Map;return(0,U.walk)(c,{enter:s=>{switch(s.type){case Ye:{t.add(s.children);break}case k:{P.includes(s.name)?(e.set("hasNestedSelector",!0),e.set("hasLogicalPseudoFunc",!0),s.name==="has"&&e.set("hasHasPseudoFunc",!0)):qe.includes(s.name)?e.set("hasStatePseudoClass",!0):fe.includes(s.name)&&Array.isArray(s.children)&&s.children.length&&e.set("hasNestedSelector",!0);break}case O:{Le.test(s.name)&&e.set("hasNestedSelector",!0);break}case ne:{s.selector&&(e.set("hasNestedSelector",!0),e.set("hasNthChildOfSelector",!0));break}default:}}}),e.get("hasNestedSelector")&&(0,U.findAll)(c,(s,a,r)=>{if(r){if(s.type===k&&P.includes(s.name)){let f=r.filter(u=>{let{name:h,type:n}=u;return n===k&&P.includes(h)});for(let{children:u}of f)for(let{children:h}of u)for(let{children:n}of h)t.has(n)&&t.delete(n)}else if(s.type===k&&fe.includes(s.name)&&Array.isArray(s.children)&&s.children.length){let f=r.filter(u=>{let{children:h,name:n,type:i}=u;return i===k&&fe.includes(n)&&Array.isArray(h)&&h.length});for(let{children:u}of f)for(let{children:h}of u)t.has(h)&&t.delete(h)}else if(s.type===O&&Le.test(s.name)){let f=r.filter(u=>{let{name:h,type:n}=u;return n===O&&Le.test(h)});for(let{children:u}of f)for(let{children:h}of u)t.has(h)&&t.delete(h)}else if(s.type===ne&&s.selector){let f=r.filter(u=>{let{selector:h,type:n}=u;return n===ne&&h});for(let{selector:u}of f){let{children:h}=u;for(let{children:n}of h)t.has(n)&&t.delete(n)}}}}),{branches:[...t],info:Object.fromEntries(e)}},ve=c=>{let t=[...c];if(t.length>1){let e=new Map([[O,1],[R,2],[j,4],[F,8],[B,16],[k,32]]);t.sort((o,s)=>{let{type:a}=o,{type:r}=s,f=e.get(a),u=e.get(r),h;return f===u?h=0:f>u?h=1:h=-1,h})}return t},De=c=>{let t,e;if(c&&typeof c=="string")c.indexOf("|")>-1?[t,e]=c.split("|"):(t="*",e=c);else throw new DOMException(`Invalid selector ${c}`,N);return{prefix:t,localName:e}};var Ee=(c,t,e={})=>{let{forgive:o,warn:s}=e;if(t===O)switch(c){case"after":case"backdrop":case"before":case"cue":case"cue-region":case"first-letter":case"first-line":case"file-selector-button":case"marker":case"placeholder":case"selection":case"target-text":{if(s)throw new DOMException(`Unsupported pseudo-element ::${c}`,C);break}case"part":case"slotted":{if(s)throw new DOMException(`Unsupported pseudo-element ::${c}()`,C);break}default:if(c.startsWith("-webkit-")){if(s)throw new DOMException(`Unsupported pseudo-element ::${c}`,C)}else if(!o)throw new DOMException(`Unknown pseudo-element ::${c}`,N)}else throw new TypeError(`Unexpected ast type ${T(t)}`)},rt=(c,t)=>{let{name:e}=c;if(!e){let s;throw e===""?s="(empty String)":s=T(e),new TypeError(`Unexpected ast type ${s}`)}let o=he(t);return e===o},nt=(c,t)=>{let{name:e,type:o,value:s}=c,a;o===Ke&&s?a=s:o===We&&e&&(a=M(e));let{contentType:r}=t.ownerDocument,f=/^(?:application\/xhtml\+x|text\/ht)ml$/.test(r),u=/^(?:application\/(?:[\w\-.]+\+)?|image\/[\w\-.]+\+|text\/)xml$/.test(r);if(a==="*")if(f&&t.hasAttribute("lang")||u&&t.hasAttribute("xml:lang")){if(f&&t.getAttribute("lang")||u&&t.getAttribute("xml:lang"))return!0}else{let h=t.parentNode,n;for(;h&&h.nodeType===1;){if(f&&h.hasAttribute("lang")||u&&h.hasAttribute("xml:lang")){(f&&h.hasAttribute("lang")||u&&h.hasAttribute("xml:lang"))&&(n=!0);break}h=h.parentNode}return!!n}else if(a&&new RegExp(`^(?:\\*-)?${ae}${G}$`,"i").test(a)){let n;if(a.indexOf("-")>-1){let[i,l,...p]=a.split("-"),m;i==="*"?m=`${ae}${G}`:m=`${i}${G}`;let d=`-${l}${G}`,E=p.length,b="";if(E)for(let x=0;x<E;x++)b+=`-${p[x]}${G}`;n=new RegExp(`^${m}${d}${b}$`,"i")}else n=new RegExp(`^${a}${G}$`,"i");if(f&&t.hasAttribute("lang")||u&&t.hasAttribute("xml:lang")){let i=f&&t.getAttribute("lang")||u&&t.getAttribute("xml:lang")||"";return n.test(i)}else{let i=t.parentNode,l;for(;i&&i.nodeType===1;){if(f&&i.hasAttribute("lang")||u&&i.hasAttribute("xml:lang")){let p=f&&i.getAttribute("lang")||u&&i.getAttribute("xml:lang")||"";l=n.test(p);break}i=i.parentNode}return!!l}}return!1},at=(c,t)=>{let{flags:e,matcher:o,name:s,value:a}=c;if(typeof e=="string"&&!/^[is]$/i.test(e)){let f=(0,_.generate)(c);throw new DOMException(`Invalid selector ${f}`,N)}let{attributes:r}=t;if(r?.length){let f=t.ownerDocument.contentType,u;f==="text/html"?typeof e=="string"&&/^s$/i.test(e)?u=!1:u=!0:typeof e=="string"&&/^i$/i.test(e)?u=!0:u=!1;let h=M(s.name);u&&(h=h.toLowerCase());let n=new Set;if(h.indexOf("|")>-1){let{prefix:i,localName:l}=De(h);for(let p of r){let{name:m,value:d}=p;switch(u&&(m=m.toLowerCase(),d=d.toLowerCase()),i){case"":{l===m&&n.add(d);break}case"*":{m.indexOf(":")>-1?m.endsWith(`:${l}`)&&n.add(d):l===m&&n.add(d);break}default:if(m.indexOf(":")>-1){let[E,b]=m.split(":");if(E==="xml"&&b==="lang")continue;i===E&&l===b&&et(i,t)&&n.add(d)}}}}else for(let{name:i,value:l}of r)if(u&&(i=i.toLowerCase(),l=l.toLowerCase()),i.indexOf(":")>-1){let[p,m]=i.split(":");if(p==="xml"&&m==="lang")continue;h===m&&n.add(l)}else h===i&&n.add(l);if(n.size){let{name:i,value:l}=a??{},p;switch(i?u?p=i.toLowerCase():p=i:l?u?p=l.toLowerCase():p=l:l===""&&(p=l),o){case"=":return typeof p=="string"&&n.has(p);case"~=":{if(p&&typeof p=="string"){let m;for(let d of n)if(new Set(d.split(/\s+/)).has(p)){m=!0;break}return!!m}return!1}case"|=":{if(p&&typeof p=="string"){let m;for(let d of n)if(d===p||d.startsWith(`${p}-`)){m=d;break}return!!m}return!1}case"^=":{if(p&&typeof p=="string"){let m;for(let d of n)if(d.startsWith(`${p}`)){m=d;break}return!!m}return!1}case"$=":{if(p&&typeof p=="string"){let m;for(let d of n)if(d.endsWith(`${p}`)){m=d;break}return!!m}return!1}case"*=":{if(p&&typeof p=="string"){let m;for(let d of n)if(d.includes(`${p}`)){m=d;break}return!!m}return!1}case null:default:return!0}}}return!1},ot=(c,t,e={})=>{let o=M(c.name),{localName:s,namespaceURI:a,prefix:r}=t,{forgive:f}=e,{prefix:u,localName:h}=De(o,t);t.ownerDocument.contentType==="text/html"&&/[A-Z][\\w-]*/i.test(s)&&(u=u.toLowerCase(),h=h.toLowerCase());let n,i;switch(s.indexOf(":")>-1?[n,i]=s.split(":"):(n=r||"",i=s),u){case"":return!n&&!a&&(h==="*"||h===i);case"*":return h==="*"||h===i;default:{let l=t.lookupNamespaceURI(u),p=t.lookupNamespaceURI(n);if(l===p&&u===n)return h==="*"||h===i;if(!f&&!l)throw new DOMException(`Undeclared namespace ${u}`,N);return!1}}};var W="next",Y="prev",xe=class{#r;#a;#i;#s;#h;#c;#d;#f;#m;#l;#e;#p;#y;#b;#x;#n;#N;#u;#w;#E;#o;#t;constructor(t){this.#t=t,this.#a=new WeakMap,this.#h=new WeakMap,this.#m=new WeakMap,this.#x=new WeakMap,this.#c=null,this.#d=null,this.#l=null,this._registerEventListeners()}onError(t,e={}){if(!(e.noexcept??this.#y))if(t instanceof DOMException||t instanceof this.#t.DOMException)if(t.name===C)this.#o&&console.warn(t.message);else throw new this.#t.DOMException(t.message,t.name);else throw t.name in this.#t?new this.#t[t.name](t.message):t}setup(t,e,o={}){let{noexcept:s,warn:a}=o;return this.#y=!!s,this.#o=!!a,this.#e=e,[this.#s,this.#n,this.#u]=Je(e),this.#N=t,[this.#r,this.#p]=this._correspond(t),this.#m=new WeakMap,this.#E=new WeakMap,this.#w=null,this}_registerEventListeners(){let t={capture:!0,passive:!0},e=[],o=["focus","focusin"];for(let r of o)e.push(this.#t.addEventListener(r,f=>{this.#d=f},t));let s=["keydown","keyup"];for(let r of s)e.push(this.#t.addEventListener(r,f=>{let{key:u}=f;Xe.includes(u)||(this.#c=f)},t));let a=["mouseover","mousedown","mouseup","click","mouseout"];for(let r of a)e.push(this.#t.addEventListener(r,f=>{this.#c=f},t));return e}_correspond(t){let e=[];this.#i=!1,this.#f=!1;let o;if(this.#h.has(this.#s)){let s=this.#h.get(this.#s);if(s&&s.has(`${t}`)){let a=s.get(`${t}`);o=a.ast,this.#i=a.descendant,this.#f=a.invalidate}}if(o){let s=o.length;for(let a=0;a<s;a++)o[a].dir=null,o[a].filtered=!1,o[a].find=!1,e[a]=[]}else{let s;try{s=H(t)}catch(d){return this.onError(d)}let{branches:a,info:r}=z(s),{hasHasPseudoFunc:f,hasLogicalPseudoFunc:u,hasNthChildOfSelector:h,hasStatePseudoClass:n}=r,i=f||n||!!(u&&h),l=!1,p=0;o=[];for(let[...d]of a){let E=[],b=d.shift();if(b&&b.type!==v){let x=new Set;for(;b;){let y=b.name;if(b.type===v){let[A]=d;if(A.type===v)return this.onError(new this.#t.DOMException(`Invalid selector ${t}`,N));y==="+"||y==="~"?i=!0:l=!0,E.push({combo:b,leaves:ve(x)}),x.clear()}else b&&(y&&typeof y=="string"&&(y=M(y),typeof y=="string"&&y!==b.name&&(b.name=y),/[|:]/.test(y)&&(b.namespace=!0)),x.add(b));if(d.length)b=d.shift();else{E.push({combo:null,leaves:ve(x)}),x.clear();break}}}o.push({branch:E,dir:null,filtered:!1,find:!1}),e[p]=[],p++}let m;this.#h.has(this.#s)?m=this.#h.get(this.#s):m=new Map,m.set(`${t}`,{ast:o,descendant:l,invalidate:i}),this.#h.set(this.#s,m),this.#i=l,this.#f=i}return[o,e]}_createTreeWalker(t,e={}){let{force:o=!1,whatToShow:s=1281}=e,a;return o?a=this.#s.createTreeWalker(t,s):this.#E.has(t)?a=this.#E.get(t):(a=this.#s.createTreeWalker(t,s),this.#E.set(t,a)),a}_prepareQuerySelectorWalker(){return this.#b=this._createTreeWalker(this.#e),this.#b}_collectNthChild(t,e,o={}){let{a:s,b:a,reverse:r,selector:f}=t,{parentNode:u}=e,h=new Set,n;if(f){if(this.#a.has(f))n=this.#a.get(f);else{let{branches:l}=z(f);n=l,this.#f||this.#a.set(f,n)}let{branches:i}=z(f);n=i}if(u){let i=this._createTreeWalker(u,{force:!0}),l=i.firstChild(),p=new Set,m=0;if(n)for(;l;){if(Ae(l)){let d;for(let E of n)if(d=this._matchLeaves(E,l,o),!d)break;d&&p.add(l)}m++,l=i.nextSibling()}else for(;l;)m++,l=i.nextSibling();if(s===0){if(a>0&&a<=m){if(p.size){l=g(u,i),r?l=i.lastChild():l=i.firstChild();let d=0;for(;l;){if(p.has(l)){if(d===a-1){h.add(l);break}d++}r?l=i.previousSibling():l=i.nextSibling()}}else if(!f){l=g(u,i),r?l=i.lastChild():l=i.firstChild();let d=0;for(;l;){if(d===a-1){h.add(l);break}r?l=i.previousSibling():l=i.nextSibling(),d++}}}}else{let d=a-1;if(s>0)for(;d<0;)d+=s;if(d>=0&&d<m){l=g(u,i),r?l=i.lastChild():l=i.firstChild();let E=0,b=s>0?0:a-1;for(;l&&(l&&d>=0&&d<m);)p.size?p.has(l)&&(b===d&&(h.add(l),d+=s),s>0?b++:b--):E===d&&(f||h.add(l),d+=s),r?l=i.previousSibling():l=i.nextSibling(),E++}}if(r&&h.size>1){let d=[...h];return new Set(d.reverse())}}else if(e===this.#n&&s+a===1)if(n){let i;for(let l of n)if(i=this._matchLeaves(l,e,o),i)break;i&&h.add(e)}else h.add(e);return h}_collectNthOfType(t,e){let{a:o,b:s,reverse:a}=t,{localName:r,namespaceURI:f,parentNode:u,prefix:h}=e,n=new Set;if(u){let i=this._createTreeWalker(u,{force:!0}),l=g(u,i);l=i.firstChild();let p=0;for(;l;)p++,l=i.nextSibling();if(o===0){if(s>0&&s<=p){l=g(u,i),a?l=i.lastChild():l=i.firstChild();let m=0;for(;l;){let{localName:d,namespaceURI:E,prefix:b}=l;if(d===r&&b===h&&E===f){if(m===s-1){n.add(l);break}m++}a?l=i.previousSibling():l=i.nextSibling()}}}else{let m=s-1;if(o>0)for(;m<0;)m+=o;if(m>=0&&m<p){l=g(u,i),a?l=i.lastChild():l=i.firstChild();let d=o>0?0:s-1;for(;l;){let{localName:E,namespaceURI:b,prefix:x}=l;if(E===r&&x===h&&b===f){if(d===m&&(n.add(l),m+=o),m<0||m>=p)break;o>0?d++:d--}a?l=i.previousSibling():l=i.nextSibling()}}}if(a&&n.size>1){let m=[...n];return new Set(m.reverse())}}else e===this.#n&&o+s===1&&n.add(e);return n}_matchAnPlusB(t,e,o,s={}){let{nth:{a,b:r,name:f},selector:u}=t,h=new Map;if(f?(f==="even"?(h.set("a",2),h.set("b",0)):f==="odd"&&(h.set("a",2),h.set("b",1)),o.indexOf("last")>-1&&h.set("reverse",!0)):(typeof a=="string"&&/-?\d+/.test(a)?h.set("a",a*1):h.set("a",0),typeof r=="string"&&/-?\d+/.test(r)?h.set("b",r*1):h.set("b",0),o.indexOf("last")>-1&&h.set("reverse",!0)),o==="nth-child"||o==="nth-last-child"){u&&h.set("selector",u);let n=Object.fromEntries(h);return this._collectNthChild(n,e,s)}else if(o==="nth-of-type"||o==="nth-last-of-type"){let n=Object.fromEntries(h);return this._collectNthOfType(n,e)}return new Set}_matchHasPseudoFunc(t,e,o={}){if(Array.isArray(t)&&t.length){let s=[...t],[a]=s,{type:r}=a,f;r===v?f=s.shift():f={name:" ",type:v};let u=[];for(;s.length;){let[i]=s,{type:l}=i;if(l===v)break;u.push(s.shift())}let h={combo:f,leaves:u};o.dir=W;let n=this._matchCombinator(h,e,o);if(n.size){if(s.length){let i=!1;for(let l of n)if(i=this._matchHasPseudoFunc(s,l,o),i)break;return i}return!0}}return!1}_matchLogicalPseudoFunc(t,e,o={}){let{astName:s,branches:a,twigBranches:r}=t,f=(o.isShadowRoot||this.#u)&&e.nodeType===11;if(s==="has"){let u;for(let h of a)if(u=this._matchHasPseudoFunc(h,e,o),u)break;if(u)if(f){if(this.#w)return e}else return e}else{if(f){let n;for(let i of a)if(i.length>1){n=!0;break}else if(s==="not"){let[{type:l}]=i;if(l!==k){n=!0;break}}if(n)return null}o.forgive=s==="is"||s==="where";let u=r.length,h;for(let n=0;n<u;n++){let i=r[n],l=i.length-1,{leaves:p}=i[l];if(h=this._matchLeaves(p,e,o),h&&l>0){let m=new Set([e]);for(let d=l-1;d>=0;d--){let E=i[d],b=[];o.dir=Y;for(let x of m){let y=this._matchCombinator(E,x,o);y.size&&b.push(...y)}if(b.length)d===0?h=!0:m=new Set(b);else{h=!1;break}}}if(h)break}if(s==="not")return h?null:e;if(h)return e}return null}_matchPseudoClassSelector(t,e,o={}){let{children:s,name:a}=t,{localName:r,parentNode:f}=e,{forgive:u,warn:h=this.#o}=o,n=new Set;if(Array.isArray(s)&&P.includes(a)){if(!s.length&&a!=="is"&&a!=="where"){let p=(0,_.generate)(t);return this.onError(new this.#t.DOMException(`Invalid selector ${p}`,N))}let i;if(this.#a.has(t))i=this.#a.get(t);else{let{branches:p}=z(t);if(a==="has"){let m;for(let d of s){let E=(0,_.find)(d,b=>P.includes(b.name)&&(0,_.find)(b,x=>x.name==="has")?b:null);if(E){let b=E.name;if(b==="is"||b==="where"){m=!0;break}else{let x=(0,_.generate)(t);return this.onError(new this.#t.DOMException(`Invalid selector ${x}`,N))}}}if(m)return n;i={astName:a,branches:p}}else{let m=[];for(let[...d]of p){let E=[],b=new Set,x=d.shift();for(;x;)if(x.type===v?(E.push({combo:x,leaves:[...b]}),b.clear()):x&&b.add(x),d.length)x=d.shift();else{E.push({combo:null,leaves:[...b]}),b.clear();break}m.push(E)}i={astName:a,branches:p,twigBranches:m},this.#f||this.#a.set(t,i)}}let l=this._matchLogicalPseudoFunc(i,e,o);l&&n.add(l)}else if(Array.isArray(s))if(/^nth-(?:last-)?(?:child|of-type)$/.test(a)){if(s.length!==1){let p=(0,_.generate)(t);return this.onError(new this.#t.DOMException(`Invalid selector ${p}`,N))}let[i]=s;return this._matchAnPlusB(i,e,a,o)}else switch(a){case"dir":{if(s.length!==1){let p=(0,_.generate)(t);return this.onError(new this.#t.DOMException(`Invalid selector ${p}`,N))}let[i]=s;rt(i,e)&&n.add(e);break}case"lang":{if(!s.length){let l=(0,_.generate)(t);return this.onError(new this.#t.DOMException(`Invalid selector ${l}`,N))}let i;for(let l of s)if(i=nt(l,e),i)break;i&&n.add(e);break}case"state":{if(ue(e)){let[{value:i}]=s;if(i)if(e[i])n.add(e);else for(let l in e){let p=e[l];if(p instanceof this.#t.ElementInternals){p?.states?.has(i)&&n.add(e);break}}}break}case"current":case"nth-col":case"nth-last-col":{h&&this.onError(new this.#t.DOMException(`Unsupported pseudo-class :${a}()`,C));break}case"host":case"host-context":break;case"contains":{h&&this.onError(new this.#t.DOMException(`Unknown pseudo-class :${a}()`,C));break}default:u||this.onError(new this.#t.DOMException(`Unknown pseudo-class :${a}()`,N))}else switch(a){case"any-link":case"link":{(r==="a"||r==="area")&&e.hasAttribute("href")&&n.add(e);break}case"local-link":{if((r==="a"||r==="area")&&e.hasAttribute("href")){let{href:i,origin:l,pathname:p}=new URL(this.#s.URL),m=new URL(e.getAttribute("href"),i);m.origin===l&&m.pathname===p&&n.add(e)}break}case"visited":break;case"hover":{let{target:i,type:l}=this.#c??{};/^(?:click|mouse(?:down|over|up))$/.test(l)&&e.contains(i)&&n.add(e);break}case"active":{let{buttons:i,target:l,type:p}=this.#c??{};p==="mousedown"&&i&1&&e.contains(l)&&n.add(e);break}case"target":{let{hash:i}=new URL(this.#s.URL);e.id&&i===`#${e.id}`&&this.#s.contains(e)&&n.add(e);break}case"target-within":{let{hash:i}=new URL(this.#s.URL);if(i){let l=i.replace(/^#/,""),p=this.#s.getElementById(l);for(;p;){if(p===e){n.add(e);break}p=p.parentNode}}break}case"scope":{this.#e.nodeType===1?!this.#u&&e===this.#e&&n.add(e):e===this.#s.documentElement&&n.add(e);break}case"focus":{e===this.#s.activeElement&&pe(e)&&n.add(e);break}case"focus-visible":{if(e===this.#s.activeElement&&pe(e)){let i;if(Ce(e))i=!0;else if(this.#d){let{relatedTarget:l,target:p}=this.#d;if(p===e)if(Ce(l))i=!0;else if(this.#c){let{key:m,target:d,type:E}=this.#c;d===l?(this.#l===null||p===this.#l)&&(i=!0):m==="Tab"?(E==="keydown"&&d!==e||E==="keyup"&&d===e)&&(d===p?(this.#l===null||d===this.#l&&l===null)&&(i=!0):i=!0):m&&(E==="keydown"||E==="keyup")&&d===e&&(i=!0)}else(l===null||l===this.#l)&&(i=!0)}i?(this.#l=e,n.add(e)):this.#l===e&&(this.#l=null)}break}case"focus-within":{let i,l=this.#s.activeElement;if(pe(l))for(;l;){if(l===e){i=!0;break}l=l.parentNode}i&&n.add(e);break}case"open":case"closed":{(r==="details"||r==="dialog")&&(e.hasAttribute("open")?a==="open"&&n.add(e):a==="closed"&&n.add(e));break}case"disabled":case"enabled":{if([...ce,"fieldset","optgroup","option"].includes(r)||ue(e,{formAssociated:!0})){let l;if(e.disabled||e.hasAttribute("disabled"))l=!0;else if(e.localName==="option")f.localName==="optgroup"&&(f.disabled||f.hasAttribute("disabled"))&&(l=!0);else if(e.localName!=="optgroup"){let p=f;for(;p;)if(p.localName==="fieldset"&&(p.disabled||p.hasAttribute("disabled"))){let m=p.firstElementChild;for(;m&&m.localName!=="legend";)m=m.nextElementSibling;m&&m.contains(e)||(l=!0);break}else{if(p.localName==="form")break;if(p.parentNode?.nodeType===1){if(p.parentNode.localName==="form")break;p=p.parentNode}else break}}l?a==="disabled"&&n.add(e):a==="enabled"&&n.add(e)}break}case"read-only":case"read-write":{let i,l;switch(r){case"textarea":{e.readOnly||e.hasAttribute("readonly")||e.disabled||e.hasAttribute("disabled")?i=!0:l=!0;break}case"input":{!e.type||Z.includes(e.type)?e.readOnly||e.hasAttribute("readonly")||e.disabled||e.hasAttribute("disabled")?i=!0:l=!0:i=!0;break}default:ee(e)?l=!0:i=!0}i?a==="read-only"&&n.add(e):a==="read-write"&&l&&n.add(e);break}case"placeholder-shown":{let i;if(e.placeholder?i=e.placeholder:e.hasAttribute("placeholder")&&(i=e.getAttribute("placeholder")),typeof i=="string"&&!/[\r\n]/.test(i)){let l;r==="textarea"?l=e:r==="input"&&(e.hasAttribute("type")?[...Q,"number"].includes(e.getAttribute("type"))&&(l=e):l=e),l&&e.value===""&&n.add(e)}break}case"checked":{let i=e.getAttribute("type");(e.checked&&r==="input"&&(i==="checkbox"||i==="radio")||e.selected&&r==="option")&&n.add(e);break}case"indeterminate":{if(e.indeterminate&&r==="input"&&e.type==="checkbox"||r==="progress"&&!e.hasAttribute("value"))n.add(e);else if(r==="input"&&e.type==="radio"&&!e.hasAttribute("checked")){let i=e.name,l=e.parentNode;for(;l&&l.localName!=="form";)l=l.parentNode;l||(l=this.#s.documentElement);let p=this._createTreeWalker(l),m=g(l,p);m=p.firstChild();let d;for(;m&&!(m.localName==="input"&&m.getAttribute("type")==="radio"&&(m.hasAttribute("name")?m.getAttribute("name")===i&&(d=!!m.checked):d=!!m.checked,d));)m=p.nextNode();d||n.add(e)}break}case"default":{let i=["checkbox","radio"],l=["button","reset"],p=["image","submit"],m=e.getAttribute("type");if(r==="button"&&!(e.hasAttribute("type")&&l.includes(m))||r==="input"&&e.hasAttribute("type")&&p.includes(m)){let d=e.parentNode;for(;d&&d.localName!=="form";)d=d.parentNode;if(d){let E=this._createTreeWalker(d),b=g(d,E);for(b=E.firstChild();b;){let x=b.localName,y=b.getAttribute("type"),A;if(x==="button"?A=!(b.hasAttribute("type")&&l.includes(y)):x==="input"&&(A=b.hasAttribute("type")&&p.includes(y)),A){b===e&&n.add(e);break}b=E.nextNode()}}}else(r==="input"&&e.hasAttribute("type")&&i.includes(m)&&e.hasAttribute("checked")||r==="option"&&e.hasAttribute("selected"))&&n.add(e);break}case"valid":case"invalid":{let i=[...ce,"form"];if(i.includes(r)){let l;e.checkValidity()&&(e.maxLength>=0?e.maxLength>=e.value.length&&(l=!0):l=!0),l?a==="valid"&&n.add(e):a==="invalid"&&n.add(e)}else if(r==="fieldset"){let l=this._createTreeWalker(e),p=g(e,l);p=l.firstChild();let m;if(!p)m=!0;else for(;p&&!(i.includes(p.localName)&&(p.checkValidity()?p.maxLength>=0?m=p.maxLength>=p.value.length:m=!0:m=!1,!m));)p=l.nextNode();m?a==="valid"&&n.add(e):a==="invalid"&&n.add(e)}break}case"in-range":case"out-of-range":{let i=[..._e,"number","range"],l=e.getAttribute("type");if(r==="input"&&!(e.readonly||e.hasAttribute("readonly"))&&!(e.disabled||e.hasAttribute("disabled"))&&i.includes(l)){let p=e.validity.rangeUnderflow||e.validity.rangeOverflow;(a==="out-of-range"&&p||a==="in-range"&&!p&&(e.hasAttribute("min")||e.hasAttribute("max")||l==="range"))&&n.add(e)}break}case"required":case"optional":{let i,l;if(r==="select"||r==="textarea")e.required||e.hasAttribute("required")?i=!0:l=!0;else if(r==="input")if(e.hasAttribute("type")){let p=[...Z,"checkbox","file","radio"],m=e.getAttribute("type");p.includes(m)&&(e.required||e.hasAttribute("required"))?i=!0:l=!0}else e.required||e.hasAttribute("required")?i=!0:l=!0;(a==="required"&&i||a==="optional"&&l)&&n.add(e);break}case"root":{e===this.#s.documentElement&&n.add(e);break}case"empty":{if(e.hasChildNodes()){let i=this._createTreeWalker(e,{force:!0,whatToShow:4294967295}),l=i.firstChild(),p;for(;l&&(p=l.nodeType!==1&&l.nodeType!==3,!!p);)l=i.nextSibling();p&&n.add(e)}else n.add(e);break}case"first-child":{(f&&e===f.firstElementChild||e===this.#n)&&n.add(e);break}case"last-child":{(f&&e===f.lastElementChild||e===this.#n)&&n.add(e);break}case"only-child":{(f&&e===f.firstElementChild&&e===f.lastElementChild||e===this.#n)&&n.add(e);break}case"first-of-type":{if(f){let[i]=this._collectNthOfType({a:0,b:1},e);i&&n.add(i)}else e===this.#n&&n.add(e);break}case"last-of-type":{if(f){let[i]=this._collectNthOfType({a:0,b:1,reverse:!0},e);i&&n.add(i)}else e===this.#n&&n.add(e);break}case"only-of-type":{if(f){let[i]=this._collectNthOfType({a:0,b:1},e);if(i===e){let[l]=this._collectNthOfType({a:0,b:1,reverse:!0},e);l===e&&n.add(e)}}else e===this.#n&&n.add(e);break}case"defined":{e.hasAttribute("is")||r.includes("-")?ue(e)&&n.add(e):(e instanceof this.#t.HTMLElement||e instanceof this.#t.SVGElement)&&n.add(e);break}case"popover-open":{e.popover&&Ae(e)&&n.add(e);break}case"host":case"host-context":break;case"after":case"before":case"first-letter":case"first-line":{h&&this.onError(new this.#t.DOMException(`Unsupported pseudo-element ::${a}`,C));break}case"autofill":case"blank":case"buffering":case"current":case"fullscreen":case"future":case"has-slotted":case"modal":case"muted":case"past":case"paused":case"picture-in-picture":case"playing":case"seeking":case"stalled":case"user-invalid":case"user-valid":case"volume-locked":case"-webkit-autofill":{h&&this.onError(new this.#t.DOMException(`Unsupported pseudo-class :${a}`,C));break}default:a.startsWith("-webkit-")?h&&this.onError(new this.#t.DOMException(`Unsupported pseudo-class :${a}`,C)):u||this.onError(new this.#t.DOMException(`Unknown pseudo-class :${a}`,N))}return n}_matchShadowHostPseudoClass(t,e){let{children:o,name:s}=t;if(Array.isArray(o)){if(o.length!==1){let h=(0,_.generate)(t);return this.onError(new this.#t.DOMException(`Invalid selector ${h}`,N))}let{branches:a}=z(o[0]),[r]=a,[...f]=r,{host:u}=e;if(s==="host"){let h;for(let n of f){let{type:i}=n;if(i===v){let l=(0,_.generate)(t);return this.onError(new this.#t.DOMException(`Invalid selector ${l}`,N))}if(h=this._matchSelector(n,u).has(u),!h)break}return h?e:null}else if(s==="host-context"){let h=u,n;for(;h;){for(let i of f){let{type:l}=i;if(l===v){let p=(0,_.generate)(t);return this.onError(new this.#t.DOMException(`Invalid selector ${p}`,N))}if(n=this._matchSelector(i,h).has(h),!n)break}if(n)break;h=h.parentNode}return n?e:null}}else if(s==="host")return e;return this.onError(new this.#t.DOMException(`Invalid selector :${s}`,N))}_matchSelector(t,e,o={}){let{type:s}=t,a=M(t.name),r=new Set;if(e.nodeType===1)switch(s){case B:{at(t,e)&&r.add(e);break}case R:{e.id===a&&r.add(e);break}case j:{e.classList.contains(a)&&r.add(e);break}case k:return this._matchPseudoClassSelector(t,e,o);case F:{ot(t,e,o)&&r.add(e);break}case O:default:try{Ee(a,s,o)}catch(f){this.onError(f)}}else if(this.#u&&s===k&&e.nodeType===11){if(P.includes(a))return o.isShadowRoot=!0,this._matchPseudoClassSelector(t,e,o);if(a==="host"||a==="host-context"){let f=this._matchShadowHostPseudoClass(t,e,o);f&&(this.#w=!0,r.add(f))}}return r}_matchLeaves(t,e,o={}){let s;if(this.#f?s=this.#m.get(t):s=this.#x.get(t),s&&s.has(e)){let{matched:a}=s.get(e);return a}else{let a=!0,r=[...ce,"fieldset","form"],f=["any-link","defined","dir","link"];e.nodeType===1&&r.includes(e.localName)&&(a=!1);let u;for(let h of t){switch(h.type){case B:case R:{a=!1;break}case k:{f.includes(h.name)&&(a=!1);break}default:}if(u=this._matchSelector(h,e,o).has(e),!u)break}return a&&(s||(s=new WeakMap),s.set(e,{matched:u}),this.#f?this.#m.set(t,s):this.#x.set(t,s)),u}}_findDescendantNodes(t,e,o={}){let[s,...a]=t,r=a.length>0,{type:f}=s,u=M(s.name),h=new Set,n=!1;if(this.#u||e.nodeType!==1)n=!0;else switch(f){case O:{Ee(u,f,o);break}case R:{if(this.#n.nodeType===1)n=!0;else{let i=this.#n.getElementById(u);i&&i!==e&&e.contains(i)&&(r?this._matchLeaves(a,i,o)&&h.add(i):h.add(i))}break}default:n=!0}if(n){let i=this._createTreeWalker(e),l=g(e,i);for(l=i.firstChild();l;)this._matchLeaves(t,l,o)&&h.add(l),l=i.nextNode()}return h}_matchCombinator(t,e,o={}){let{combo:s,leaves:a}=t,{name:r}=s,{parentNode:f}=e,{dir:u}=o,h=new Set;if(u===W)switch(r){case"+":{let n=e.nextElementSibling;n&&this._matchLeaves(a,n,o)&&h.add(n);break}case"~":{if(f){let n=e.nextElementSibling;for(;n;)this._matchLeaves(a,n,o)&&h.add(n),n=n.nextElementSibling}break}case">":{let n=e.firstElementChild;for(;n;)this._matchLeaves(a,n,o)&&h.add(n),n=n.nextElementSibling;break}case" ":default:{let n=this._findDescendantNodes(a,e,o);if(n.size)return n}}else switch(r){case"+":{let n=e.previousElementSibling;n&&this._matchLeaves(a,n,o)&&h.add(n);break}case"~":{if(f){let n=f.firstElementChild;for(;n&&n!==e;)this._matchLeaves(a,n,o)&&h.add(n),n=n.nextElementSibling}break}case">":{f&&this._matchLeaves(a,f,o)&&h.add(f);break}case" ":default:{let n=[],i=f;for(;i;)this._matchLeaves(a,i,o)&&n.push(i),i=i.parentNode;if(n.length)return new Set(n.reverse())}}return h}_findQswalker(t,e,o={}){let{force:s,targetType:a}=o,r=this.#b,f=[],u=g(e,r,!!s);if(u)for((u.nodeType!==1||u===e&&u!==this.#n)&&(u=r.nextNode());u&&!(this._matchLeaves(t,u,{warn:this.#o})&&(f.push(u),a!==L));)u=r.nextNode();return f}_matchSelf(t){let e=[],o=!1;return this._matchLeaves(t,this.#e,{warn:this.#o})&&(e.push(this.#e),o=!0),[e,o]}_findLineal(t,e){let{complex:o}=e,s=[],a=!1,r=this._matchLeaves(t,this.#e,{warn:this.#o});if(r&&(s.push(this.#e),a=!0),!r||o){let f=this.#e.parentNode;for(;f&&(r=this._matchLeaves(t,f,{warn:this.#o}),r&&(s.push(f),a=!0),f.parentNode);)f=f.parentNode}return[s,a]}_findEntryNodes(t,e,o){let{leaves:s}=t,[a,...r]=s,f=r.length>0,{name:u,type:h}=a,n=[],i=!1,l=!1;switch(h){case O:{Ee(u,h,{warn:this.#o});break}case R:{if(e===D)[n,i]=this._matchSelf(s);else if(e===$)[n,i]=this._findLineal(s,{complex:o});else if(e===S&&this.#n.nodeType!==1){let p=this.#n.getElementById(u);p&&(f?this._matchLeaves(r,p,{warn:this.#o})&&(n.push(p),i=!0):(n.push(p),i=!0))}else n=this._findQswalker(s,this.#e,{targetType:e}),n.length&&(i=!0);break}case j:{e===D?[n,i]=this._matchSelf(s):e===$?[n,i]=this._findLineal(s,{complex:o}):(n=this._findQswalker(s,this.#e,{targetType:e}),n.length&&(i=!0));break}case F:{e===D?[n,i]=this._matchSelf(s):e===$?[n,i]=this._findLineal(s,{complex:o}):(n=this._findQswalker(s,this.#e,{targetType:e}),n.length&&(i=!0));break}default:if(e!==$&&(u==="host"||u==="host-context")){let p;if(this.#u&&this.#e.nodeType===11?p=this._matchShadowHostPseudoClass(a,this.#e):f&&this.#e.nodeType===1&&(p=this._matchShadowHostPseudoClass(a,this.#e.shadowRoot)),p){let m;if(f){for(let d of r)if(/^host(?:-context)?$/.test(d.name)?m=this._matchShadowHostPseudoClass(d,p)===p:d.name==="has"?m=this._matchPseudoClassSelector(d,p,{}).has(p):m=!1,!m)break}else m=!0;m&&(n.push(p),i=!0)}}else e===D?[n,i]=this._matchSelf(s):e===$?[n,i]=this._findLineal(s,{complex:o}):e===S?(n=this._findQswalker(s,this.#e,{targetType:e}),n.length&&(i=!0)):l=!0}return{compound:f,filtered:i,nodes:n,pending:l}}_collectNodes(t){let e=this.#r.values();if(t===L||t===S){let o=new Set,s=0;for(let{branch:a}of e){let r=a.length,f=r>1,u=a[0],h,n;if(f){let{combo:d,leaves:[{name:E,type:b}]}=u,x=a[r-1],{leaves:[{name:y,type:A}]}=x;if(h=W,n=u,this.#N.includes(":scope")||A===O||A===R)h=Y,n=x;else if(E==="*"&&b===F)h=Y,n=x;else if(y==="*"&&A===F)h=W,n=u;else if(r===2){let{name:se}=d;(se==="+"||se==="~")&&(h=Y,n=x)}}else h=Y,n=u;let{compound:i,filtered:l,nodes:p,pending:m}=this._findEntryNodes(n,t,f);p.length?(this.#r[s].find=!0,this.#p[s]=p):m&&o.add(new Map([["index",s],["twig",n]])),this.#r[s].dir=h,this.#r[s].filtered=l||!i,s++}if(o.size){let a,r;this.#e!==this.#n&&this.#e.nodeType===1?(a=this.#e,r=this.#b):(a=this.#n,r=this._createTreeWalker(a));let f=g(a,r);for(;f;){let u=!1;if(this.#e.nodeType===1?f===this.#e?u=!0:u=this.#e.contains(f):u=!0,u)for(let h of o){let{leaves:n}=h.get("twig");if(this._matchLeaves(n,f,{warn:this.#o})){let l=h.get("index");this.#r[l].filtered=!0,this.#r[l].find=!0,this.#p[l].push(f)}}f!==r.currentNode&&(f=g(f,r)),f=r.nextNode()}}}else{let o=0;for(let{branch:s}of e){let a=s[s.length-1],r=s.length>1,{compound:f,filtered:u,nodes:h}=this._findEntryNodes(a,t,r);h.length&&(this.#r[o].find=!0,this.#p[o]=h),this.#r[o].dir=Y,this.#r[o].filtered=u||!f,o++}}return[this.#r,this.#p]}_getCombinedNodes(t,e,o){let s=[];for(let a of e){let r=this._matchCombinator(t,a,{dir:o,warn:this.#o});r.size&&s.push(...r)}return s.length?new Set(s):new Set}_matchNodeNext(t,e,o){let{combo:s,index:a}=o,{combo:r,leaves:f}=t[a],u={combo:s,leaves:f},h=this._getCombinedNodes(u,e,W);if(h.size)if(a===t.length-1){let[n]=de(h);return n}else return this._matchNodeNext(t,h,{combo:r,index:a+1});return null}_matchNodePrev(t,e,o){let{index:s}=o,a=t[s],r=new Set([e]),f=this._getCombinedNodes(a,r,Y);if(f.size){if(s===0)return e;{let u;for(let h of f)if(u=this._matchNodePrev(t,h,{index:s-1}),u)break;if(u)return e}}return null}find(t){(t===L||t===S)&&this._prepareQuerySelectorWalker();let[[...e],o]=this._collectNodes(t),s=e.length,a,r=new Set;for(let f=0;f<s;f++){let{branch:u,dir:h,find:n}=e[f],i=u.length;if(i&&n){let l=o[f],p=l.length,m=i-1;if(m===0)if((t===L||t===S)&&this.#e.nodeType===1)for(let d=0;d<p;d++){let E=l[d];if(E!==this.#e&&this.#e.contains(E)&&(r.add(E),t===S))break}else if(t===L)if(r.size){let d=[...r];r=new Set([...d,...l]),a=!0}else r=new Set(l);else{let[d]=l;r.add(d)}else if(t===L)if(h===W){let{combo:d}=u[0],E=d;for(let b of l){let x=new Set([b]);for(let y=1;y<i;y++){let{combo:A,leaves:se}=u[y],ft={combo:E,leaves:se};if(x=this._getCombinedNodes(ft,x,h),x.size)if(y===m)if(r.size){let ht=[...r];r=new Set([...ht,...x]),a=!0,E=d}else r=x,E=d;else E=A;else break}}}else for(let d of l){let E=new Set([d]);for(let b=m-1;b>=0;b--){let x=u[b];if(E=this._getCombinedNodes(x,E,h),E.size)b===0&&(r.add(d),i>1&&r.size>1&&(a=!0));else break}}else if(t===S&&h===W){let{combo:d}=u[0],E;for(let b of l)if(E=this._matchNodeNext(u,new Set([b]),{combo:d,index:1}),E){r.add(E);break}if(!E){let{leaves:b}=u[0],[x]=l,[y]=this._findQswalker(b,x,{targetType:t});for(;y;){if(E=this._matchNodeNext(u,new Set([y]),{combo:d,index:1}),E){r.add(E);break}[y]=this._findQswalker(b,y,{targetType:t,force:!0})}}}else{let d;for(let E of l)if(d=this._matchNodePrev(u,E,{index:m-1}),d){r.add(E);break}if(!d&&t===S){let{leaves:E}=u[m],[b]=l,[x]=this._findQswalker(E,b,{targetType:t});for(;x;){if(d=this._matchNodePrev(u,x,{index:m-1}),d){r.add(x);break}[x]=this._findQswalker(E,x,{targetType:t,force:!0})}}}}}return t===S?(r.delete(this.#e),r.size>1&&(r=new Set(de(r)))):t===L&&(r.delete(this.#e),a&&r.size>1&&(r=new Set(de(r)))),r}};var Ie=new RegExp(`${q}${le}${q}`,"i"),lt=new RegExp(`${q}${Be}${q}`,"i"),ct=new RegExp(`^${ze}$`),Re=class{#r;#a;#i;#s;constructor(t,e){this.#r=t,this.#a=e??t.document,this.#i=new xe(t),this.#s=tt(t,e)}matches(t,e,o){if(e?.nodeType){if(e.nodeType!==1){let r=new this.#r.TypeError(`Unexpected node ${e.nodeName}`);this.#i.onError(r,o)}}else{let r=new this.#r.TypeError(`Unexpected type ${T(e)}`);this.#i.onError(r,o)}let s=e.ownerDocument;if(s===this.#a&&s.contentType==="text/html"&&e.parentNode){let r={complex:Ie.test(t),compound:!1,descend:!1,simple:!1,target:D};if(te(t,r))try{return this.#s.match(t,e)}catch{}}let a;try{this.#i.setup(t,e,o),a=this.#i.find(D).size}catch(r){this.#i.onError(r,o)}return!!a}closest(t,e,o){if(e?.nodeType){if(e.nodeType!==1){let r=new this.#r.TypeError(`Unexpected node ${e.nodeName}`);this.#i.onError(r,o)}}else{let r=new this.#r.TypeError(`Unexpected type ${T(e)}`);this.#i.onError(r,o)}let s=e.ownerDocument;if(s===this.#a&&s.contentType==="text/html"&&e.parentNode){let r={complex:Ie.test(t),compound:!1,descend:!1,simple:!1,target:$};if(te(t,r))try{return this.#s.closest(t,e)}catch{}}let a;try{this.#i.setup(t,e,o);let r=this.#i.find($);if(r.size){let f=e;for(;f;){if(r.has(f)){a=f;break}f=f.parentNode}}}catch(r){this.#i.onError(r,o)}return a??null}querySelector(t,e,o){if(!e?.nodeType){let r=new this.#r.TypeError(`Unexpected type ${T(e)}`);this.#i.onError(r,o)}let s;if(e.nodeType===9?s=e:s=e.ownerDocument,s===this.#a&&s.contentType==="text/html"){let r={complex:!1,compound:!(ct.test(t)||Ie.test(t)),descend:lt.test(t),simple:ct.test(t),target:S};if(te(t,r))try{return this.#s.first(t,e)}catch{}}let a;try{this.#i.setup(t,e,o);let r=this.#i.find(S);r.size&&([a]=r)}catch(r){this.#i.onError(r,o)}return a??null}querySelectorAll(t,e,o){if(!e?.nodeType){let r=new this.#r.TypeError(`Unexpected type ${T(e)}`);this.#i.onError(r,o)}let s;if(e.nodeType===9?s=e:s=e.ownerDocument,s===this.#a&&s.contentType==="text/html"){let r={complex:!1,compound:!1,descend:lt.test(t),simple:!1,target:L};if(te(t,r))try{return this.#s.select(t,e)}catch{}}let a;try{this.#i.setup(t,e,o);let r=this.#i.find(L);r.size&&(a=[...r])}catch(r){this.#i.onError(r,o)}return a??[]}};0&&(module.exports={DOMSelector});
/*!
 * DOM Selector - A CSS selector engine.
 * @license MIT
 * @copyright asamuzaK (Kazz)
 * @see {@link https://github.com/asamuzaK/domSelector/blob/main/LICENSE}
 */
//# sourceMappingURL=index.cjs.map